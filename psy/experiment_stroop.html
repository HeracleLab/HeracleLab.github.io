<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script src="savedata.js"></script>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <title>Stroop - PsyToolkit Experiments</title>
</head>
<body onload="whenloaded()">
<script>
    function tmpmouse(e) {
        MouseX = (e.clientX - psy_canvas.getBoundingClientRect().left) * 800 / psy_canvas.getBoundingClientRect().width;
        MouseY = (e.clientY - psy_canvas.getBoundingClientRect().top) * 600 / psy_canvas.getBoundingClientRect().height;
        if (MouseX > 175 && MouseX < 625 && MouseY > 125 && MouseY < 475) {
            window.removeEventListener('mousedown', tmpmouse, false);
            main();
        }
    }

    function whenloaded() {
        tmp1 = document.getElementById('exp');
        tmp2 = tmp1.getContext('2d');
        tmp2.fillStyle = 'red';
        tmp2.fillRect(175, 125, 450, 350);
        tmp2.fillStyle = 'yellow';
        tmp2.font = '24px Arial';
        tmp2.textAlign = 'center';
        tmp2.fillText('Fai click qui per iniziare', 400, 300);
        window.addEventListener('mousedown', tmpmouse, false)
        var canvasbox = document.getElementById('cbox');
        iswebkit = RegExp('webkit').test(navigator.userAgent.toLowerCase());
        canvasbox.addEventListener(iswebkit ? 'webkitfullscreenchange' : 'fullscreenchange', (event) => {
            if (document.fullscreenElement == null) {
                psy_screen_scale(0, false);
            }
        })
    }</script>
<center>
    <div id="cbox" style="overflow:hidden;width:800px;height:600px;border:0px
    solid black;background-color:black;display:flex;justify-content:center;align-items:center">
        <canvas tabindex="1" id="exp" style="display:flex;justify-content:center;align-items:center;outline:none;display:
    block;background-color:black;border:none;padding:0;margin:0;" width="800" height="600"></canvas>
    </div>
    <div style="display:flex;justify-content:left;width:800px;background-color:black;border:0px solid black;">
        <button type="button"
                style="background-color:black;color:white;border:none;padding:0;font-size:100%;font-family:inherit"
                title="fullscreen" onclick='psy_fullscreen(document.getElementById("cbox"));psy_screen_scale(0,true);'>
            &nbsp;â›¶
        </button>
    </div>
</center>
<script>
    var click_to_start_text = "Click to start";

    tmp1 = document.getElementById('exp');
    tmp2 = tmp1.getContext('2d');
    tmp2.fillStyle = 'grey';
    tmp2.fillRect(175, 125, 450, 350);
    tmp2.fillStyle = 'blue';
    tmp2.font = '24px Arial';
    tmp2.textAlign = 'center';
    tmp2.fillText('Wait a second ...', 400, 300);
</script>
<script>
    var $jscomp = $jscomp || {};
    $jscomp.scope = {};
    $jscomp.arrayIteratorImpl = function (a) {
        var b = 0;
        return function () {
            return b < a.length ? {done: !1, value: a[b++]} : {done: !0}
        }
    };
    $jscomp.arrayIterator = function (a) {
        return {next: $jscomp.arrayIteratorImpl(a)}
    };
    $jscomp.makeIterator = function (a) {
        var b = "undefined" != typeof Symbol && Symbol.iterator && a[Symbol.iterator];
        return b ? b.call(a) : $jscomp.arrayIterator(a)
    };
    $jscomp.arrayFromIterator = function (a) {
        for (var b, c = []; !(b = a.next()).done;) c.push(b.value);
        return c
    };
    $jscomp.arrayFromIterable = function (a) {
        return a instanceof Array ? a : $jscomp.arrayFromIterator($jscomp.makeIterator(a))
    };
    $jscomp.owns = function (a, b) {
        return Object.prototype.hasOwnProperty.call(a, b)
    };
    $jscomp.assign = "function" == typeof Object.assign ? Object.assign : function (a, b) {
        for (var c = 1; c < arguments.length; c++) {
            var d = arguments[c];
            if (d) for (var e in d) $jscomp.owns(d, e) && (a[e] = d[e])
        }
        return a
    };
    $jscomp.ASSUME_ES5 = !1;
    $jscomp.ASSUME_NO_NATIVE_MAP = !1;
    $jscomp.ASSUME_NO_NATIVE_SET = !1;
    $jscomp.SIMPLE_FROUND_POLYFILL = !1;
    $jscomp.ISOLATE_POLYFILLS = !1;
    $jscomp.defineProperty = $jscomp.ASSUME_ES5 || "function" == typeof Object.defineProperties ? Object.defineProperty : function (a, b, c) {
        if (a == Array.prototype || a == Object.prototype) return a;
        a[b] = c.value;
        return a
    };
    $jscomp.getGlobal = function (a) {
        a = ["object" == typeof globalThis && globalThis, a, "object" == typeof window && window, "object" == typeof self && self, "object" == typeof global && global];
        for (var b = 0; b < a.length; ++b) {
            var c = a[b];
            if (c && c.Math == Math) return c
        }
        throw Error("Cannot find global object");
    };
    $jscomp.global = $jscomp.getGlobal(this);
    $jscomp.polyfills = {};
    $jscomp.propertyToPolyfillSymbol = {};
    $jscomp.POLYFILL_PREFIX = "$jscp$";
    $jscomp.IS_SYMBOL_NATIVE = "function" === typeof Symbol && "symbol" === typeof Symbol("x");
    var $jscomp$lookupPolyfilledValue = function (a, b) {
        var c = $jscomp.propertyToPolyfillSymbol[b];
        if (null == c) return a[b];
        c = a[c];
        return void 0 !== c ? c : a[b]
    };
    $jscomp.polyfill = function (a, b, c, d) {
        b && ($jscomp.ISOLATE_POLYFILLS ? $jscomp.polyfillIsolated(a, b, c, d) : $jscomp.polyfillUnisolated(a, b, c, d))
    };
    $jscomp.polyfillUnisolated = function (a, b, c, d) {
        c = $jscomp.global;
        a = a.split(".");
        for (d = 0; d < a.length - 1; d++) {
            var e = a[d];
            e in c || (c[e] = {});
            c = c[e]
        }
        a = a[a.length - 1];
        d = c[a];
        b = b(d);
        b != d && null != b && $jscomp.defineProperty(c, a, {configurable: !0, writable: !0, value: b})
    };
    $jscomp.polyfillIsolated = function (a, b, c, d) {
        var e = a.split(".");
        a = 1 === e.length;
        d = e[0];
        d = !a && d in $jscomp.polyfills ? $jscomp.polyfills : $jscomp.global;
        for (var f = 0; f < e.length - 1; f++) {
            var g = e[f];
            g in d || (d[g] = {});
            d = d[g]
        }
        e = e[e.length - 1];
        c = $jscomp.IS_SYMBOL_NATIVE && "es6" === c ? d[e] : null;
        b = b(c);
        null != b && (a ? $jscomp.defineProperty($jscomp.polyfills, e, {
            configurable: !0,
            writable: !0,
            value: b
        }) : b !== c && ($jscomp.propertyToPolyfillSymbol[e] = $jscomp.IS_SYMBOL_NATIVE ? $jscomp.global.Symbol(e) : $jscomp.POLYFILL_PREFIX + e, e = $jscomp.propertyToPolyfillSymbol[e],
            $jscomp.defineProperty(d, e, {configurable: !0, writable: !0, value: b})))
    };
    $jscomp.polyfill("Object.assign", function (a) {
        return a || $jscomp.assign
    }, "es6", "es3");
    $jscomp.polyfill("Array.from", function (a) {
        return a ? a : function (a, c, d) {
            c = null != c ? c : function (a) {
                return a
            };
            var b = [], f = "undefined" != typeof Symbol && Symbol.iterator && a[Symbol.iterator];
            if ("function" == typeof f) {
                a = f.call(a);
                for (var g = 0; !(f = a.next()).done;) b.push(c.call(d, f.value, g++))
            } else for (f = a.length, g = 0; g < f; g++) b.push(c.call(d, a[g], g));
            return b
        }
    }, "es6", "es3");
    $jscomp.SYMBOL_PREFIX = "jscomp_symbol_";
    $jscomp.initSymbol = function () {
        $jscomp.initSymbol = function () {
        };
        $jscomp.global.Symbol || ($jscomp.global.Symbol = $jscomp.Symbol)
    };
    $jscomp.SymbolClass = function (a, b) {
        this.$jscomp$symbol$id_ = a;
        $jscomp.defineProperty(this, "description", {configurable: !0, writable: !0, value: b})
    };
    $jscomp.SymbolClass.prototype.toString = function () {
        return this.$jscomp$symbol$id_
    };
    $jscomp.Symbol = function () {
        function a(c) {
            if (this instanceof a) throw new TypeError("Symbol is not a constructor");
            return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX + (c || "") + "_" + b++, c)
        }

        var b = 0;
        return a
    }();
    $jscomp.initSymbolIterator = function () {
        $jscomp.initSymbol();
        var a = $jscomp.global.Symbol.iterator;
        a || (a = $jscomp.global.Symbol.iterator = $jscomp.global.Symbol("Symbol.iterator"));
        "function" != typeof Array.prototype[a] && $jscomp.defineProperty(Array.prototype, a, {
            configurable: !0,
            writable: !0,
            value: function () {
                return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))
            }
        });
        $jscomp.initSymbolIterator = function () {
        }
    };
    $jscomp.initSymbolAsyncIterator = function () {
        $jscomp.initSymbol();
        var a = $jscomp.global.Symbol.asyncIterator;
        a || (a = $jscomp.global.Symbol.asyncIterator = $jscomp.global.Symbol("Symbol.asyncIterator"));
        $jscomp.initSymbolAsyncIterator = function () {
        }
    };
    $jscomp.iteratorPrototype = function (a) {
        $jscomp.initSymbolIterator();
        a = {next: a};
        a[$jscomp.global.Symbol.iterator] = function () {
            return this
        };
        return a
    };
    $jscomp.iteratorFromArray = function (a, b) {
        $jscomp.initSymbolIterator();
        a instanceof String && (a += "");
        var c = 0, d = {
            next: function () {
                if (c < a.length) {
                    var e = c++;
                    return {value: b(e, a[e]), done: !1}
                }
                d.next = function () {
                    return {done: !0, value: void 0}
                };
                return d.next()
            }
        };
        d[Symbol.iterator] = function () {
            return d
        };
        return d
    };
    $jscomp.polyfill("Array.prototype.keys", function (a) {
        return a ? a : function () {
            return $jscomp.iteratorFromArray(this, function (a) {
                return a
            })
        }
    }, "es6", "es3");
    $jscomp.polyfill("Number.isFinite", function (a) {
        return a ? a : function (a) {
            return "number" !== typeof a ? !1 : !isNaN(a) && Infinity !== a && -Infinity !== a
        }
    }, "es6", "es3");
    $jscomp.polyfill("Array.prototype.fill", function (a) {
        return a ? a : function (a, c, d) {
            var b = this.length || 0;
            0 > c && (c = Math.max(0, b + c));
            if (null == d || d > b) d = b;
            d = Number(d);
            0 > d && (d = Math.max(0, b + d));
            for (c = Number(c || 0); c < d; c++) this[c] = a;
            return this
        }
    }, "es6", "es3");
    $jscomp.polyfill("Object.is", function (a) {
        return a ? a : function (a, c) {
            return a === c ? 0 !== a || 1 / a === 1 / c : a !== a && c !== c
        }
    }, "es6", "es3");
    $jscomp.polyfill("Array.prototype.includes", function (a) {
        return a ? a : function (a, c) {
            var b = this;
            b instanceof String && (b = String(b));
            var e = b.length;
            c = c || 0;
            for (0 > c && (c = Math.max(c + e, 0)); c < e; c++) {
                var f = b[c];
                if (f === a || Object.is(f, a)) return !0
            }
            return !1
        }
    }, "es7", "es3");
    $jscomp.checkStringArgs = function (a, b, c) {
        if (null == a) throw new TypeError("The 'this' value for String.prototype." + c + " must not be null or undefined");
        if (b instanceof RegExp) throw new TypeError("First argument to String.prototype." + c + " must not be a regular expression");
        return a + ""
    };
    $jscomp.polyfill("String.prototype.includes", function (a) {
        return a ? a : function (a, c) {
            return -1 !== $jscomp.checkStringArgs(this, a, "includes").indexOf(a, c || 0)
        }
    }, "es6", "es3");
    $jscomp.polyfill("Array.prototype.flat", function (a) {
        return a ? a : function (a) {
            a = void 0 === a ? 1 : a;
            for (var b = [], d = 0; d < this.length; d++) {
                var e = this[d];
                Array.isArray(e) && 0 < a ? (e = Array.prototype.flat.call(e, a - 1), b.push.apply(b, e)) : b.push(e)
            }
            return b
        }
    }, "es9", "es5");
    $jscomp.polyfill("Math.trunc", function (a) {
        return a ? a : function (a) {
            a = Number(a);
            if (isNaN(a) || Infinity === a || -Infinity === a || 0 === a) return a;
            var b = Math.floor(Math.abs(a));
            return 0 > a ? -b : b
        }
    }, "es6", "es3");
    var MAXSPRITES = 100, MAXBITMAPS = 1E3, PSY_CENTRAL = -99999, MAX_FONTS = 100, psy_font_number = 0, psy_fonts = [],
        psy_fonts_size = [], PSY_VIDEO_DOUBLEBUFFER = 1, PSY_KEY_STATUS_CORRECT = 1, PSY_KEY_STATUS_WRONG = 2,
        PSY_KEY_STATUS_TIMEOUT = 3, psy_screen_center_x = 0, psy_screen_x_offset = 0, psy_screen_center_y = 0,
        psy_screen_y_offset = 0, psy_screen_width = 800, psy_screen_height = 600, psy_frame_w = 800, psy_frame_h = 600,
        psy_bgcol_r = 0, psy_bgcol_g = 0, psy_bgcol_b = 0, psy_exp_start_time = 0, psy_exp_current_time = 0,
        psy_blockorder = 1, tablerow = 0, keystatus =
            {key: 0, status: 0, time: 0, totaltime: 0, mouse_x: 0, mouse_y: 0, bitmap: 0}, possiblekeys = [],
        readkeys_option_size = 5, readkeys_option_show = 1, readkeys_option_show_x = 0, readkeys_option_show_y = 0,
        readkeys_option_font = 1, readkeys_option_placeholders = 0, readkeys_option_placeholder_bitmap = -1,
        readkeys_option_placeholder_w = 0, readkeys_option_placeholder_h = 0, readkeys_option_spacing = 30,
        readkeys_option_font_color = [255, 255, 255],
        mousestatus = {key: 0, status: 0, time: 0, totaltime: 0, x: 0, y: 0},
        psy_canvas = document.getElementById("exp"), canvas_x_offset =
            psy_canvas.getBoundingClientRect().left, canvas_y_offset = psy_canvas.getBoundingClientRect().top,
        psy_mouse_cursor = 0, psy_mouse_store = 0, ctx = psy_canvas.getContext("2d"),
        log = document.getElementById("log"), output = document.getElementById("Output");
    outputdata = String();
    var psy_bitmaps = [], psy_sounds = [], psy_freqs = [], psy_freqs_number = 0, psy_bitmaps_loaded = 0,
        psy_sounds_loaded = 0, psy_videos_loaded = 0, bmp_number = 0, psy_video_number = 0, psy_sound_number = 0,
        psy_pb = {color1: [0, 0, 0], color2: [0, 0, 0], items1: 0, items2: 0, itemwidth: 0, between: 0, layout: 0};

    function psy_stimuli_loaded() {
        total_stimuli = bmp_number + psy_sound_number + psy_video_number;
        total_loaded = psy_bitmaps_loaded + psy_sounds_loaded + psy_videos_loaded;
        var a = 0 < total_stimuli ? Math.round(total_loaded / total_stimuli * 100) : 100;
        if ((tmp = psy_bitmaps_loaded < bmp_number || psy_sounds_loaded < psy_sound_number || psy_videos_loaded < psy_video_number) && 100 > a) return a;
        if (tmp && 100 == a) return 99;
        if (psy_bitmaps_loaded == bmp_number && psy_sounds_loaded == psy_sound_number && psy_videos_loaded == psy_video_number) return 100
    }

    var stimuli_loader_indicator = 0;

    function when_stimuli_loaded_do(a) {
        tmp = psy_stimuli_loaded();
        ctx.fillStyle = hexrgb(psy_bgcol_r, psy_bgcol_g, psy_bgcol_b);
        ctx.fillRect(0, 0, psy_screen_width, psy_screen_height);
        ctx.font = "30px Arial";
        ctx.textAlign = "left";
        0 == stimuli_loader_indicator ? (ctx.fillStyle = "white", stimuli_loader_indicator = 1) : (ctx.fillStyle = "green", stimuli_loader_indicator = 0);
        100 > tmp ? (0 == tmp ? ctx.fillText("Caricamento dati...", 100, 100) : ctx.fillText("Caricamento dati " + tmp + "%", 100, 100), setTimeout(when_stimuli_loaded_do, 250, a)) : setTimeout(a, 0)
    }

    function psy_load_bitmap(a) {
        psy_bitmaps[bmp_number] = new Image;
        psy_bitmaps[bmp_number].onload = function () {
            psy_bitmaps_loaded++
        };
        psy_bitmaps[bmp_number].src = a;
        bmp_number++;
        return bmp_number - 1
    }

    function psy_load_sound(a) {
        psy_sounds[psy_sound_number] = new Audio;
        psy_sounds[psy_sound_number].addEventListener("canplaythrough", function () {
            psy_sounds_loaded++
        });
        psy_sounds[psy_sound_number].addEventListener("error", function (a) {
            this.load()
        });
        psy_sounds[psy_sound_number].src = a;
        psy_sounds[psy_sound_number].load();
        psy_sound_number++;
        return psy_sound_number - 1
    }

    var psy_videos = [], psy_videos_playing = 0;

    function psy_videos_loaded_call(a) {
        psy_videos_loaded++
    }

    var PsyVideo = function (a) {
        this.video = document.createElement("video");
        this.video.autoplay = !1;
        this.video.addEventListener("canplaythrough", psy_videos_loaded_call);
        this.video.addEventListener("error", function () {
            this.video.load()
        });
        this.video.src = a;
        this.video.load();
        this.playing = !1
    };
    PsyVideo.prototype.play = function () {
        0 == this.playing && (this.playing = !0, this.video.play(), 0 == psy_videos_playing && (requestAnimationFrame(psy_animation_updater), psy_videos_playing++))
    };
    PsyVideo.prototype.pause = function () {
        this.video.pause()
    };
    PsyVideo.prototype.unpause = function () {
        this.video.paused && this.video.play()
    };
    PsyVideo.prototype.clear = function () {
        this.playing = !1;
        this.video.pause();
        this.video.currentTime = 0;
        psy_videos_playing--
    };
    PsyVideo.prototype.rewind = function () {
        this.video.currentTime = 0
    };
    PsyVideo.prototype.mute = function () {
        this.video.muted = !0
    };
    PsyVideo.prototype.unmute = function () {
        this.video.muted = !1
    };
    PsyVideo.prototype.loop = function () {
        this.video.loop = !0
    };
    PsyVideo.prototype.once = function () {
        this.video.loop = !1
    };

    function psy_animation_updater() {
        for (i = 0; i < psy_stimuli1_end; i++) 5 == psy_stimuli1[i].type && 1 == psy_videos[psy_stimuli1[i].bitmap - 1].playing && ctx.drawImage(psy_videos[psy_stimuli1[i].bitmap - 1].video, psy_stimuli1[i].rect.x, psy_stimuli1[i].rect.y, psy_stimuli1[i].rect.width, psy_stimuli1[i].rect.height);
        0 < psy_videos_playing && requestAnimationFrame(psy_animation_updater)
    }

    function psy_load_video(a) {
        psy_videos.push(new PsyVideo(a));
        psy_video_number++;
        return psy_video_number - 1
    }

    function psy_play_video(a, b, c) {
        psy_stimuli1[psy_stimuli1_end] = new psy_stimulus1;
        psy_stimuli1[psy_stimuli1_end].rect = new Rectangle;
        psy_stimuli1[psy_stimuli1_end].type = 5;
        psy_stimuli1[psy_stimuli1_end].bitmap = a;
        psy_stimuli1[psy_stimuli1_end].on = 1;
        psy_stimuli1[psy_stimuli1_end].x = b;
        psy_stimuli1[psy_stimuli1_end].y = c;
        b = b == PSY_CENTRAL ? psy_screen_center_x - psy_videos[a - 1].video.videoWidth / 2 : b + psy_screen_x_offset - psy_videos[a - 1].video.videoWidth / 2;
        tmpy = c == PSY_CENTRAL ? psy_screen_center_y - psy_videos[a - 1].video.videoHeight /
            2 : c + psy_screen_y_offset - psy_videos[a - 1].video.videoHeight / 2;
        psy_stimuli1[psy_stimuli1_end].rect.x = b;
        psy_stimuli1[psy_stimuli1_end].rect.y = tmpy;
        psy_stimuli1[psy_stimuli1_end].rect.width = psy_videos[a - 1].video.videoWidth;
        psy_stimuli1[psy_stimuli1_end].rect.height = psy_videos[a - 1].video.videoHeight;
        psy_stimuli1_n++;
        psy_stimuli1_end++;
        psy_videos[a - 1].play()
    }

    function psy_play_video_wh(a, b, c, d, e) {
        psy_stimuli1[psy_stimuli1_end] = new psy_stimulus1;
        psy_stimuli1[psy_stimuli1_end].rect = new Rectangle;
        psy_stimuli1[psy_stimuli1_end].type = 5;
        psy_stimuli1[psy_stimuli1_end].bitmap = a;
        psy_stimuli1[psy_stimuli1_end].on = 1;
        psy_stimuli1[psy_stimuli1_end].x = b;
        psy_stimuli1[psy_stimuli1_end].y = c;
        b = b == PSY_CENTRAL ? psy_screen_center_x - d / 2 : b + psy_screen_x_offset - d / 2;
        tmpy = c == PSY_CENTRAL ? psy_screen_center_y - e / 2 : c + psy_screen_y_offset - e / 2;
        psy_stimuli1[psy_stimuli1_end].rect.x = b;
        psy_stimuli1[psy_stimuli1_end].rect.y =
            tmpy;
        psy_stimuli1[psy_stimuli1_end].rect.width = d;
        psy_stimuli1[psy_stimuli1_end].rect.height = e;
        psy_stimuli1_n++;
        psy_stimuli1_end++;
        psy_videos[a - 1].play()
    }

    function psy_play_video_scale(a, b, c, d) {
        psy_stimuli1[psy_stimuli1_end] = new psy_stimulus1;
        psy_stimuli1[psy_stimuli1_end].rect = new Rectangle;
        psy_stimuli1[psy_stimuli1_end].type = 5;
        psy_stimuli1[psy_stimuli1_end].bitmap = a;
        psy_stimuli1[psy_stimuli1_end].on = 1;
        psy_stimuli1[psy_stimuli1_end].x = b;
        psy_stimuli1[psy_stimuli1_end].y = c;
        var e = psy_videos[a - 1].video.videoWidth * d / 100;
        d = psy_videos[a - 1].video.videoHeight * d / 100;
        b = b == PSY_CENTRAL ? psy_screen_center_x - e / 2 : b + psy_screen_x_offset - e / 2;
        tmpy = c == PSY_CENTRAL ? psy_screen_center_y -
            d / 2 : c + psy_screen_y_offset - d / 2;
        psy_stimuli1[psy_stimuli1_end].rect.x = b;
        psy_stimuli1[psy_stimuli1_end].rect.y = tmpy;
        psy_stimuli1[psy_stimuli1_end].rect.width = e;
        psy_stimuli1[psy_stimuli1_end].rect.height = d;
        psy_stimuli1_n++;
        psy_stimuli1_end++;
        psy_videos[a - 1].play()
    }

    function psy_continue_video(a) {
        psy_videos[a - 1].unpause()
    }

    function psy_pause_video(a) {
        psy_videos[a - 1].pause()
    }

    function psy_rewind_video(a) {
        psy_videos[a - 1].rewind()
    }

    function psy_mute_video(a) {
        psy_videos[a - 1].mute()
    }

    function psy_unmute_video(a) {
        psy_videos[a - 1].unmute()
    }

    function psy_loop_video(a) {
        psy_videos[a - 1].loop()
    }

    function psy_once_video(a) {
        psy_videos[a - 1].once()
    }

    function psy_play(a, b) {
        psy_sounds[a - 1].play();
        1 == b && (psy_sounds[a - 1].loop = !0)
    }

    function psy_silence(a) {
        0 <= a ? (psy_sounds[a - 1].pause(), psy_sounds[a - 1].currentTime = 0) : psy_freqs[psy_freqs_number + a].stop()
    }

    function psy_stop_freqs() {
        for (i = 0; i < psy_freqs_number; i++) psy_freqs[i].stop();
        psy_freqs_number = 0
    }

    function psy_play_freq(a, b, c) {
        var d = new AudioContext;
        psy_freqs[psy_freqs_number] = d.createOscillator();
        psy_freqs[psy_freqs_number].type = a;
        psy_freqs[psy_freqs_number].connect(d.destination);
        psy_freqs[psy_freqs_number].frequency.setValueAtTime(b, d.currentTime);
        psy_freqs[psy_freqs_number].start();
        setTimeout("psy_freqs[ " + psy_freqs_number + "].stop()", c);
        psy_freqs_number++
    }

    function psy_load_font(a, b) {
        psy_fonts[psy_font_number] = b + "pt " + a;
        psy_fonts_size[psy_font_number] = b;
        psy_font_number++;
        return psy_font_number - 1
    }

    function addlog(a) {
        null != log && (log.value += a + "\n", log.scrollTop = log.scrollHeight)
    }

    function addoutput(a) {
        null != output && (output.value += a + "\n");
        outputdata = outputdata + a + "\n"
    }

    function hexrgb(a, b, c) {
        h = "#";
        h = 16 > a ? h + "0" + a.toString(16) : h + a.toString(16);
        h = 16 > b ? h + "0" + b.toString(16) : h + b.toString(16);
        return h = 16 > c ? h + "0" + c.toString(16) : h + c.toString(16)
    }

    starttime = 0;

    function psy_expect_keyboard() {
        psy_readkey.expect_keyboard = !0;
        window.addEventListener("keydown", getkeydown, !0);
        window.addEventListener("keyup", getkeyup, !0);
        psy_readkey.keyupeventlistener = !0;
        psy_readkey.keydowneventlistener = !0
    }

    function psy_expect_keyboard_readkeys() {
        psy_readkeys.expect_keyboard = !0;
        window.addEventListener("keydown", readkeys_keydown, !0);
        window.addEventListener("keyup", readkeys_keyup, !0);
        psy_readkeys.keyupeventlistener = !0;
        psy_readkeys.keydowneventlistener = !0
    }

    function psy_expect_mouse() {
        psy_readkey.expect_mouse = !0
    }

    function psy_keyboard(a, b, c, d) {
        psy_readkey.expectedkey = a[c];
        psy_readkey.keys = a;
        psy_expect_keyboard();
        psy_readkey.start(current_task, d)
    }

    function psy_keyboard_readkeys(a, b) {
        psy_expect_keyboard_readkeys();
        psy_readkeys.correct_word = a;
        psy_readkeys.start(current_task, b)
    }

    var psy_readkey = {
        lasttask: "",
        starttime: 0,
        readkeytimer: "",
        rt: 0,
        key: 0,
        status: 0,
        keys: [],
        expect_keyboard: !1,
        expect_mouse: !1,
        expectedkey: 0,
        bitmap: 0,
        bitmap_range: [-1, -1],
        array_search: !1,
        mouseovereventlistener: 0,
        mousedowneventlistener: !1,
        keyupeventlistener: !1,
        keydowneventlistener: !1,
        start: function (a, b) {
            psy_readkey.rt = b;
            psy_readkey.key = 0;
            psy_readkey.starttime = (new Date).getTime();
            psy_readkey.lasttask = a;
            psy_readkey.readkeytimer = setTimeout("psy_readkey.timeout()", b);
            keystatus.status = 3;
            keystatus.bitmap = -1;
            keystatus.time =
                b;
            keystatus.key = 0
        },
        stop: function () {
            clearTimeout(psy_readkey.readkeytimer);
            psy_readkey.expect_keyboard = !1;
            psy_readkey.expect_mouse = !1;
            1 == psy_readkey.mouseovereventlistener && (window.removeEventListener("mousemove", getmouse_in_area, !1), psy_readkey.mouseovereventlistener = 0);
            2 == psy_readkey.mouseovereventlistener && (window.removeEventListener("mousemove", getmouse_in_area_check_all, !1), psy_readkey.mouseovereventlistener = 0);
            1 == psy_readkey.mousedowneventlistener && (window.removeEventListener("mousedown", getmouseclick_in_area,
                !1), psy_readkey.mousedowneventlistener = !1);
            1 == psy_readkey.keyupeventlistener && (window.removeEventListener("keyup", getkeyup, !1), psy_readkey.keyupeventlistener = !1);
            1 == psy_readkey.keydowneventlistener && (window.removeEventListener("keydown", getkeydown, !1), psy_readkey.keydowneventlistener = !1);
            eval(psy_readkey.lasttask + ".run()")
        },
        timeout: function () {
            psy_readkey.expect_keyboard = !1;
            psy_readkey.expect_mouse = !1;
            1 == psy_readkey.mouseovereventlistener && (window.removeEventListener("mousemove", getmouse_in_area, !1),
                psy_readkey.mouseovereventlistener = !1);
            1 == psy_readkey.mousedowneventlistener && (window.removeEventListener("mousedown", getmouseclick_in_area, !1), psy_readkey.mousedowneventlistener = !1);
            eval(psy_readkey.lasttask + ".run()")
        }
    }, psy_drag = {
        lasttask: "",
        timer: 0,
        starttime: 0,
        fromarray: [],
        onarray: [],
        stimulus: 0,
        stimulus_old_x: 0,
        stimulus_old_y: 0,
        x: 0,
        y: 0,
        stimulus_copy: 0,
        changed: 0,
        on: 0,
        snap: !1,
        ghost: !1,
        dragging: !1,
        exit: 0,
        maxrt: 0,
        mousedowneventlistener: !1,
        mouseupeventlistener: !1,
        mousemoveeventlistener: !1,
        xlim: [-9999,
            9999],
        ylim: [-9999, 9999],
        align_x: 0,
        align_y: 0,
        align_o: 0,
        noa: [],
        xstack: 0,
        ystack: 0,
        stop: function () {
            psy_drag.mousedowneventlistener && window.removeEventListener("mousedown", getmousedowndrag, !1);
            psy_drag.mouseupeventlistener && window.removeEventListener("mouseup", getmouseupdrag, !1);
            psy_drag.mousemoveeventlistener && window.removeEventListener("mousemove", getmousemovedrag, !1);
            psy_drag.mousedowneventlistener = !1;
            psy_drag.mouseupeventlistener = !1;
            psy_drag.mousemoveeventlistener = !1
        },
        timeout: function () {
            psy_drag.stop();
            keystatus.status = 3;
            keystatus.time = psy_drag.maxrt;
            0 < psy_drag.stimulus && (psy_canvas.style.cursor = "default", psy_stimuli1[psy_drag.stimulus - 1].x == psy_drag.stimulus_old_x && psy_stimuli1[psy_drag.stimulus - 1].y == psy_drag.stimulus_old_y && (psy_relocate_existing_stimulus(psy_drag.stimulus, psy_drag.stimulus_old_x, psy_drag.stimulus_old_y), psy_draw_all_db()));
            setTimeout(current_task + ".run()", 0)
        },
        run_dragging: function () {
            0 == psy_drag.dragging ? (psy_drag.stop(), setTimeout(current_task + ".run()", 0)) : (psy_drag.mousedowneventlistener =
                !0, window.addEventListener("mousedown", getmousedowndrag, !1))
        },
        timeout_dragging: function () {
            psy_drag.dragging = !1;
            psy_drag.timeout()
        }
    };

    function getmousedowndrag(a) {
        canvas_x_offset = psy_canvas.getBoundingClientRect().left;
        canvas_y_offset = psy_canvas.getBoundingClientRect().top;
        canvas_w = psy_canvas.getBoundingClientRect().width;
        canvas_h = psy_canvas.getBoundingClientRect().height;
        tmpmouseX = Math.round((a.clientX - canvas_x_offset) * psy_screen_width / canvas_w);
        tmpmouseY = Math.round((a.clientY - canvas_y_offset) * psy_screen_height / canvas_h);
        a = psy_bitmap_under_mouse_in_range(psy_drag.fromarray, tmpmouseX - psy_screen_x_offset, tmpmouseY - psy_screen_y_offset);
        1 == psy_drag.dragging && a == psy_drag.exit ? (clearTimeout(psy_drag.timer), psy_drag.dragging = !1, setTimeout(psy_drag.run_dragging, 0)) : 0 < a && (psy_drag.stimulus_copy = psy_copy_stimulus(a), psy_drag.stimulus_old_x = psy_stimuli1[a - 1].x, psy_drag.stimulus_old_y = psy_stimuli1[a - 1].y, psy_clear_stimuli1(a), psy_canvas.style.cursor = "move", psy_drag.stimulus = a, window.addEventListener("mousemove", getmousemovedrag, !1), window.addEventListener("mouseup", getmouseupdrag, !1), psy_drag.mousemoveeventlistener = !0, psy_drag.mouseupeventlistener =
            !0, window.removeEventListener("mousedown", getmousedowndrag, !1), psy_drag.mousedowneventlistener = !1)
    }

    function getmouseupdrag(a) {
        keystatus.time = (new Date).getTime() - psy_drag.starttime;
        psy_canvas.style.cursor = "default";
        window.removeEventListener("mousemove", getmousemovedrag, !1);
        window.removeEventListener("mouseup", getmouseupdrag, !1);
        psy_drag.mousemoveeventlistener = !1;
        psy_drag.mouseupeventlistener = !1;
        0 == psy_drag.dragging && clearTimeout(psy_drag.timer);
        0 < psy_drag.toarray.length ? 0 < psy_drag.stimulus ? (psy_stimuli1[psy_drag.stimulus - 1] = Object.assign({}, psy_stimuli1[psy_drag.stimulus_copy - 1]), psy_stimuli1_n++,
            psy_delete_last_stimulus(), canvas_x_offset = psy_canvas.getBoundingClientRect().left, canvas_y_offset = psy_canvas.getBoundingClientRect().top, canvas_w = psy_canvas.getBoundingClientRect().width, canvas_h = psy_canvas.getBoundingClientRect().height, tmpmouseX = Math.round((a.clientX - canvas_x_offset) * psy_screen_width / canvas_w) - psy_screen_x_offset, tmpmouseY = Math.round((a.clientY - canvas_y_offset) * psy_screen_height / canvas_h) - psy_screen_y_offset, keystatus.mouse_x = tmpmouseX, keystatus.mouse_y = tmpmouseY, a = psy_array_remove_value(Array.from(psy_drag.toarray),
            psy_drag.stimulus), psy_drag.on = psy_bitmap_under_mouse_in_range(a, tmpmouseX, tmpmouseY), 0 < psy_drag.on ? (1 == psy_drag.align_x && (psy_drag.xstack = 1), 3 == psy_drag.align_x && (psy_drag.xstack = -1), 1 == psy_drag.align_y && (psy_drag.ystack = 1), 3 == psy_drag.align_y && (psy_drag.ystack = -1), psy_stimuli_align(psy_drag.stimulus, psy_drag.on, psy_drag.align_x, psy_drag.align_y, psy_drag.align_o, psy_array_remove_value(psy_drag.noa, psy_drag.stimulus), psy_drag.xstack, psy_drag.ystack), psy_draw_all_db(), keystatus.status = 1) : keystatus.status =
            2, psy_drag.changed = 1) : keystatus.status = 3 : (0 < psy_drag.stimulus && (canvas_x_offset = psy_canvas.getBoundingClientRect().left, canvas_y_offset = psy_canvas.getBoundingClientRect().top, keystatus.mouse_x = a.clientX - canvas_x_offset - psy_screen_x_offset, keystatus.mouse_y = a.clientY - canvas_y_offset - psy_screen_y_offset, psy_stimuli1[psy_drag.stimulus - 1] = Object.assign({}, psy_stimuli1[psy_drag.stimulus_copy - 1]), psy_stimuli1_n++, psy_delete_last_stimulus(), psy_stimuli1[psy_drag.stimulus - 1].x != psy_drag.stimulus_old_x || psy_stimuli1[psy_drag.stimulus -
        1].y != psy_drag.stimulus_old_y) && (psy_drag.changed = 1), keystatus.status = 1);
        0 < psy_drag.stimulus && 1 != keystatus.status && (psy_stimuli1[psy_drag.stimulus - 1].x != psy_drag.stimulus_old_x || psy_stimuli1[psy_drag.stimulus - 1].y == psy_drag.stimulus_old_y) && (psy_drag.changed = 1, psy_relocate_existing_stimulus(psy_drag.stimulus, psy_drag.stimulus_old_x, psy_drag.stimulus_old_y), psy_draw_all_db());
        psy_drag.dragging ? setTimeout(psy_drag.run_dragging, 0) : setTimeout(psy_drag.lasttask + ".run()", 0)
    }

    function getmousemovedrag(a) {
        canvas_x_offset = psy_canvas.getBoundingClientRect().left;
        canvas_y_offset = psy_canvas.getBoundingClientRect().top;
        canvas_w = psy_canvas.getBoundingClientRect().width;
        canvas_h = psy_canvas.getBoundingClientRect().height;
        tmpmouseX = Math.round((a.clientX - canvas_x_offset) * psy_screen_width / canvas_w) - psy_screen_x_offset;
        tmpmouseY = Math.round((a.clientY - canvas_y_offset) * psy_screen_height / canvas_h) - psy_screen_y_offset;
        tmpmouseX < psy_drag.xlim[0] && (tmpmouseX = psy_drag.xlim[0]);
        tmpmouseX >
        psy_drag.xlim[1] && (tmpmouseX = psy_drag.xlim[1]);
        tmpmouseY < psy_drag.ylim[0] && (tmpmouseY = psy_drag.ylim[0]);
        tmpmouseY > psy_drag.ylim[1] && (tmpmouseY = psy_drag.ylim[1]);
        psy_drag.x = tmpmouseX;
        psy_drag.y = tmpmouseY;
        psy_relocate_existing_stimulus(psy_drag.stimulus_copy, tmpmouseX, tmpmouseY);
        psy_draw_all_db()
    }

    var psy_readkeys = {
            x: 0,
            y: 0,
            expect_keyboard: !1,
            lasttask: "",
            starttime: 0,
            readkeytimer: "",
            rt: 0,
            key: 0,
            current_position: 0,
            bitmap_number: [],
            status: 0,
            entered: "",
            correct_word: "",
            keyupeventlistener: !1,
            keydowneventlistener: !1,
            start: function (a, b) {
                psy_readkeys.x = readkeys_option_show_x;
                psy_readkeys.y = readkeys_option_show_y;
                psy_readkeys.current_position = 0;
                psy_readkeys.entered = "";
                if (1 == readkeys_option_placeholders) {
                    if (0 <= readkeys_option_placeholder_bitmap) for (p = 0; p < readkeys_option_size; p++) psy_add_centered_bitmap_db(readkeys_option_placeholder_bitmap,
                        psy_readkeys.x + 50 * p, psy_readkeys.y, 0); else if (-1 == readkeys_option_placeholder_bitmap) for (p = 0; p < readkeys_option_size; p++) psy_add_centered_rectangle_rgb_db(psy_readkeys.x + p * readkeys_option_spacing, psy_readkeys.y, readkeys_option_placeholder_w, readkeys_option_placeholder_h, 100, 100, 255);
                    psy_draw_all_db()
                }
                psy_readkeys.rt = b;
                psy_readkeys.starttime = (new Date).getTime();
                psy_readkeys.lasttask = a;
                psy_readkeys.readkeytimer = setTimeout("psy_readkeys.timeout()", b);
                keystatus.status = 3;
                keystatus.time = b
            },
            stop: function () {
                psy_readkeys.entered ==
                psy_readkeys.correct_word && (keystatus.status = 1);
                psy_readkeys.entered != psy_readkeys.correct_word && (keystatus.status = 2);
                clearTimeout(psy_readkeys.readkeytimer);
                psy_readkeys.expect_keyboard = !1;
                1 == psy_readkeys.keyupeventlistener && (window.removeEventListener("keyup", readkeys_keyup, !1), psy_readkeys.keyupeventlistener = !1);
                1 == psy_readkeys.keydowneventlistener && (window.removeEventListener("keydown", readkeys_keydown, !1), psy_readkeys.keydowneventlistener = !1);
                setTimeout(psy_readkeys.lasttask + ".run()", 0)
            },
            timeout: function () {
                psy_readkeys.expect_keyboard =
                    !1;
                setTimeout(psy_readkeys.lasttask + ".run()", 0)
            }
        }, pager_options = {back: 0, backX: 0, backY: 0, next: 0, nextX: 0, nextY: 0, quit: 0, quitX: 0, quitY: 0},
        inkeypress = 0;

    function getkeydown(a) {
        inkeypress++;
        1 == psy_readkey.expect_keyboard && 1 == inkeypress && -1 < psy_readkey.keys.indexOf(a.keyCode) ? (keystatus.time = (new Date).getTime() - psy_readkey.starttime, keystatus.key = psy_readkey.keys.indexOf(a.keyCode), keystatus.status = a.keyCode == psy_readkey.expectedkey ? 1 : 2, psy_readkey.expect_keyboard = !1, psy_readkey.stop()) : inkeypress = 0
    }

    function getkeyup(a) {
        1 == inkeypress && (keystatus.totaltime = (new Date).getTime() - psy_readkey.starttime);
        inkeypress = 0
    }

    function readkeys_keydown(a) {
        inkeypress++;
        if (1 == psy_readkeys.expect_keyboard) switch (keystatus.time = (new Date).getTime() - psy_readkeys.starttime, a.keyCode) {
            case 8:
                a.preventDefault();
                0 < psy_readkeys.current_position && (psy_readkeys.current_position--, psy_readkeys.entered = psy_readkeys.entered.slice(0, psy_readkeys.current_position), 1 == readkeys_option_show && (psy_clear_stimuli1(psy_readkeys.bitmap_number[psy_readkeys.current_position]), psy_draw_all_db()));
                break;
            case 13:
                psy_readkeys.expect_keyboard = !1;
                psy_readkeys.stop();
                break;
            case 16:
                1 == readkeys_option_show && psy_draw_all_db();
                break;
            case 17:
                1 == readkeys_option_show && psy_draw_all_db();
                break;
            case 18:
                1 == readkeys_option_show && psy_draw_all_db();
                break;
            case 20:
                1 == readkeys_option_show && psy_draw_all_db();
                break;
            case 27:
                1 == readkeys_option_show && psy_draw_alldb();
                break;
            case 46:
                1 == readkeys_option_show && psy_draw_all_db();
                break;
            case 144:
                1 == readkeys_option_show && psy_draw_all_db();
                break;
            default:
                psy_readkeys.current_position < readkeys_option_size && (tmpchar = a.key, 1 == tmpchar.length ? psy_readkeys.entered +=
                    a.key : (psy_readkeys.entered += "?", tmpchar = "?"), 1 == readkeys_option_show && (psy_readkeys.bitmap_number[psy_readkeys.current_position] = psy_add_text_rgb_db(readkeys_option_font, psy_readkeys.x + psy_readkeys.current_position * readkeys_option_spacing, psy_readkeys.y, PSY_CENTRAL, PSY_CENTRAL, readkeys_option_font_color[0], readkeys_option_font_color[1], readkeys_option_font_color[2], tmpchar, 0), psy_draw_all_db()), psy_readkeys.current_position++)
        } else inkeypress = 0
    }

    function readkeys_keyup(a) {
        1 == inkeypress && 13 != a.keyCode && (keystatus.totaltime = (new Date).getTime() - psy_readkeys.starttime);
        inkeypress = 0
    }

    function getmouse_in_area(a) {
        1 == psy_readkey.expect_mouse && (canvas_x_offset = psy_canvas.getBoundingClientRect().left, canvas_y_offset = psy_canvas.getBoundingClientRect().top, canvas_w = psy_canvas.getBoundingClientRect().width, canvas_h = psy_canvas.getBoundingClientRect().height, tmpmouseX = Math.round((a.clientX - canvas_x_offset) * psy_screen_width / canvas_w), tmpmouseY = Math.round((a.clientY - canvas_y_offset) * psy_screen_height / canvas_h), tmpmouseX >= psy_stimuli1[psy_readkey.bitmap - 1].rect.x && tmpmouseX <= psy_stimuli1[psy_readkey.bitmap -
        1].rect.x + psy_stimuli1[psy_readkey.bitmap - 1].rect.width && tmpmouseY >= psy_stimuli1[psy_readkey.bitmap - 1].rect.y && tmpmouseY <= psy_stimuli1[psy_readkey.bitmap - 1].rect.y + psy_stimuli1[psy_readkey.bitmap - 1].rect.height && (keystatus.time = (new Date).getTime() - psy_readkey.starttime, keystatus.status = 1, keystatus.mouse_x = tmpmouseX - psy_screen_x_offset, keystatus.mouse_y = tmpmouseY - psy_screen_y_offset, psy_readkey.expect_mouse = !1, psy_readkey.stop()))
    }

    function getmouse_in_area_check_all(a) {
        if (1 == psy_readkey.expect_mouse) {
            canvas_x_offset = psy_canvas.getBoundingClientRect().left;
            canvas_y_offset = psy_canvas.getBoundingClientRect().top;
            canvas_w = psy_canvas.getBoundingClientRect().width;
            canvas_h = psy_canvas.getBoundingClientRect().height;
            tmpmouseX = Math.round((a.clientX - canvas_x_offset) * psy_screen_width / canvas_w);
            tmpmouseY = Math.round((a.clientY - canvas_y_offset) * psy_screen_height / canvas_h);
            a = !1;
            var b = 0, c = 0, d = psy_stimuli1_end - 1;
            -1 < psy_readkey.bitmap_range[0] &&
            (c = psy_readkey.bitmap_range[0] - 1);
            for (-1 < psy_readkey.bitmap_range[1] && (d = psy_readkey.bitmap_range[1] - 1); b < psy_stimuli1_end && 0 == a;) 1 == psy_stimuli1[b].on && b >= c && b <= d && tmpmouseX >= psy_stimuli1[b].rect.x && tmpmouseX <= psy_stimuli1[b].rect.x + psy_stimuli1[b].rect.width && tmpmouseY >= psy_stimuli1[b].rect.y && tmpmouseY <= psy_stimuli1[b].rect.y + psy_stimuli1[b].rect.height && (a = !0, keystatus.time = (new Date).getTime() - psy_readkey.starttime, psy_readkey.expect_mouse = !1, keystatus.mouse_x = tmpmouseX - psy_screen_x_offset, keystatus.mouse_y =
                tmpmouseY - psy_screen_y_offset, psy_readkey.bitmap - 1 == b && (keystatus.status = 1), psy_readkey.bitmap - 1 != b && (keystatus.status = 2), psy_readkey.stop()), b += 1
        }
    }

    function getmouseclick_in_area(a) {
        if (1 == psy_readkey.expect_mouse && -1 == psy_readkey.bitmap_range[1]) {
            keystatus.time = (new Date).getTime() - psy_readkey.starttime;
            canvas_x_offset = psy_canvas.getBoundingClientRect().left;
            canvas_y_offset = psy_canvas.getBoundingClientRect().top;
            canvas_w = psy_canvas.getBoundingClientRect().width;
            canvas_h = psy_canvas.getBoundingClientRect().height;
            tmpmouseX = Math.round((a.clientX - canvas_x_offset) * psy_screen_width / canvas_w);
            tmpmouseY = Math.round((a.clientY - canvas_y_offset) * psy_screen_height /
                canvas_h);
            var b = !1;
            tmpmouseX >= psy_stimuli1[psy_readkey.bitmap - 1].rect.x && tmpmouseX <= psy_stimuli1[psy_readkey.bitmap - 1].rect.x + psy_stimuli1[psy_readkey.bitmap - 1].rect.width && tmpmouseY >= psy_stimuli1[psy_readkey.bitmap - 1].rect.y && tmpmouseY <= psy_stimuli1[psy_readkey.bitmap - 1].rect.y + psy_stimuli1[psy_readkey.bitmap - 1].rect.height ? (b = !0, keystatus.bitmap = psy_readkey.bitmap) : keystatus.bitmap = psy_bitmap_under_mouse(0, -1, -1, tmpmouseX - psy_screen_x_offset, tmpmouseY - psy_screen_y_offset);
            keystatus.status = psy_readkey.expectedkey ==
            a.button && 1 == b ? 1 : 2;
            keystatus.mouse_x = tmpmouseX - psy_screen_x_offset;
            keystatus.mouse_y = tmpmouseY - psy_screen_y_offset;
            psy_readkey.expect_mouse = !1;
            psy_readkey.stop()
        }
        if (1 == psy_readkey.expect_mouse && -1 < psy_readkey.bitmap_range[0] && !psy_readkey.array_search) {
            keystatus.time = (new Date).getTime() - psy_readkey.starttime;
            canvas_x_offset = psy_canvas.getBoundingClientRect().left;
            canvas_y_offset = psy_canvas.getBoundingClientRect().top;
            canvas_w = psy_canvas.getBoundingClientRect().width;
            canvas_h = psy_canvas.getBoundingClientRect().height;
            tmpmouseX = Math.round((a.clientX - canvas_x_offset) * psy_screen_width / canvas_w);
            tmpmouseY = Math.round((a.clientY - canvas_y_offset) * psy_screen_height / canvas_h);
            var c = psy_bitmap_under_mouse(0, psy_readkey.bitmap_range[0], psy_readkey.bitmap_range[1], tmpmouseX - psy_screen_x_offset, tmpmouseY - psy_screen_y_offset);
            c >= psy_readkey.bitmap_range[0] && c <= psy_readkey.bitmap_range[1] && (b = !1, keystatus.bitmap = c, tmpmouseX >= psy_stimuli1[psy_readkey.bitmap - 1].rect.x && tmpmouseX <= psy_stimuli1[psy_readkey.bitmap - 1].rect.x + psy_stimuli1[psy_readkey.bitmap -
            1].rect.width && tmpmouseY >= psy_stimuli1[psy_readkey.bitmap - 1].rect.y && tmpmouseY <= psy_stimuli1[psy_readkey.bitmap - 1].rect.y + psy_stimuli1[psy_readkey.bitmap - 1].rect.height && (b = !0), keystatus.status = psy_readkey.expectedkey == a.button && 1 == b ? 1 : 2, keystatus.mouse_x = tmpmouseX - psy_screen_x_offset, keystatus.mouse_y = tmpmouseY - psy_screen_y_offset, psy_readkey.expect_mouse = !1, psy_readkey.bitmap_range = [-1, -1], psy_readkey.stop())
        }
        1 == psy_readkey.expect_mouse && -1 < psy_readkey.bitmap_range[0] && psy_readkey.array_search &&
        (keystatus.time = (new Date).getTime() - psy_readkey.starttime, canvas_x_offset = psy_canvas.getBoundingClientRect().left, canvas_y_offset = psy_canvas.getBoundingClientRect().top, canvas_w = psy_canvas.getBoundingClientRect().width, canvas_h = psy_canvas.getBoundingClientRect().height, tmpmouseX = Math.round((a.clientX - canvas_x_offset) * psy_screen_width / canvas_w), tmpmouseY = Math.round((a.clientY - canvas_y_offset) * psy_screen_height / canvas_h), c = psy_bitmap_under_mouse_in_range(psy_readkey.bitmap_range, tmpmouseX - psy_screen_x_offset,
            tmpmouseY - psy_screen_y_offset), 0 < c && (b = !1, keystatus.bitmap = c, tmpmouseX >= psy_stimuli1[psy_readkey.bitmap - 1].rect.x && tmpmouseX <= psy_stimuli1[psy_readkey.bitmap - 1].rect.x + psy_stimuli1[psy_readkey.bitmap - 1].rect.width && tmpmouseY >= psy_stimuli1[psy_readkey.bitmap - 1].rect.y && tmpmouseY <= psy_stimuli1[psy_readkey.bitmap - 1].rect.y + psy_stimuli1[psy_readkey.bitmap - 1].rect.height && (b = !0), keystatus.status = psy_readkey.expectedkey == a.button && 1 == b ? 1 : 2, keystatus.mouse_x = tmpmouseX - psy_screen_x_offset, keystatus.mouse_y =
            tmpmouseY - psy_screen_y_offset, psy_readkey.expect_mouse = !1, psy_readkey.bitmap_range = [-1, -1], psy_readkey.array_search = !1, psy_readkey.stop()))
    }

    function psy_mouse_in_bitmap_rectangle(a, b) {
        psy_readkey.bitmap = a;
        window.addEventListener("mousemove", getmouse_in_area, !1);
        psy_readkey.mouseovereventlistener = 1;
        psy_expect_mouse();
        psy_readkey.start(current_task, b)
    }

    function psy_mouse_in_bitmap_rectangle_check_all(a, b, c, d) {
        psy_readkey.bitmap = a;
        psy_readkey.bitmap_range[0] = c;
        psy_readkey.bitmap_range[1] = d;
        window.addEventListener("mousemove", getmouse_in_area_check_all, !1);
        psy_readkey.mouseovereventlistener = 2;
        psy_expect_mouse();
        psy_readkey.start(current_task, b)
    }

    function psy_mouse_click_bitmap_rectangle(a, b, c) {
        psy_readkey.bitmap = b;
        psy_readkey.expectedkey = "l" == a ? 0 : 1;
        window.addEventListener("mousedown", getmouseclick_in_area, !1);
        psy_readkey.mousedowneventlistener = !0;
        psy_expect_mouse();
        psy_readkey.start(current_task, c)
    }

    function psy_mouse_click_bitmap_rectangle_range(a, b, c, d, e) {
        psy_readkey.bitmap = b;
        psy_readkey.expectedkey = "l" == a ? 0 : 1;
        window.addEventListener("mousedown", getmouseclick_in_area, !1);
        psy_readkey.mousedowneventlistener = !0;
        psy_readkey.bitmap_range = [d, e];
        psy_expect_mouse();
        psy_readkey.start(current_task, c)
    }

    function psy_mouse_click_bitmap_rectangle_array(a, b, c, d) {
        psy_readkey.bitmap = b;
        psy_readkey.expectedkey = "l" == a ? 0 : 1;
        window.addEventListener("mousedown", getmouseclick_in_area, !1);
        psy_readkey.mousedowneventlistener = !0;
        psy_readkey.bitmap_range = d;
        psy_readkey.array_search = !0;
        psy_expect_mouse();
        psy_readkey.start(current_task, c)
    }

    function psy_bitmap_under_mouse(a, b, c, d, e) {
        var f = -1, g = 1;
        var k = 0;
        var l = psy_stimuli1_n;
        -1 < b && (k = b - 1);
        -1 < c && (l = c - 1);
        0 == a && k > l && (b = l, l = k, k = b);
        1 == a && k < l && (b = l, l = k, k = b);
        for (; 1 == g && -1 == f;) d + psy_screen_x_offset >= psy_stimuli1[k].rect.x && d + psy_screen_x_offset <= psy_stimuli1[k].rect.x + psy_stimuli1[k].rect.width && e + psy_screen_y_offset >= psy_stimuli1[k].rect.y && e + psy_screen_y_offset <= psy_stimuli1[k].rect.y + psy_stimuli1[k].rect.height && (f = k), 0 == a && -1 == f && (k >= l && (g = 0), k++), 1 == a && -1 == f && (k <= l && (g = 0), k--);
        return f +
            1
    }

    function psy_bitmap_under_mouse_in_range(a, b, c) {
        for (var d = -1, e = 0, f; e < a.length && -1 == d;) f = a[e] - 1, b + psy_screen_x_offset >= psy_stimuli1[f].rect.x && b + psy_screen_x_offset <= psy_stimuli1[f].rect.x + psy_stimuli1[f].rect.width && c + psy_screen_y_offset >= psy_stimuli1[f].rect.y && c + psy_screen_y_offset <= psy_stimuli1[f].rect.y + psy_stimuli1[f].rect.height && (d = f), e < a.length && -1 == d && e++;
        return d + 1
    }

    function psy_wait(a, b) {
        Number.isFinite(a) ? 0 != a && (psy_clear_stimulus_counters_db(), psy_add_centered_bitmap_db(a, PSY_CENTRAL, PSY_CENTRAL, 0), psy_draw_all_db()) : (psy_clear_stimulus_counters_db(), psy_add_text_rgb_db(1, PSY_CENTRAL, PSY_CENTRAL, PSY_CENTRAL, PSY_CENTRAL, 255, 255, 255, a, 0), psy_draw_all_db());
        0 <= b ? (psy_readkey.expectedkey = b, psy_readkey.keys = [b], psy_expect_keyboard()) : (psy_mouse_visibility(1), psy_readkey.bitmap = 1, psy_readkey.expectedkey = 0, window.addEventListener("mousedown", getmouseclick_in_area,
            !1), psy_readkey.mousedowneventlistener = !0, psy_expect_mouse(), psy_mouse_click_bitmap_rectangle("l", 1, 9999999));
        psy_readkey.start(current_block, 99999999)
    }

    var psy_pager = {
        original_block: "", current_bitmap_in_pager: 0, bitmaps: [], n: 0, start: function (a) {
            psy_pager.original_block = current_block;
            psy_pager.n = a.length;
            psy_pager.bitmaps = a;
            current_block = "psy_pager";
            psy_pager.current_bitmap_in_pager = 0;
            keystatus.key = -1;
            psy_pager.run()
        }, run: function () {
            (0 == keystatus.key || 1 == keystatus.key) && psy_pager.current_bitmap_in_pager < psy_pager.n - 1 && psy_pager.current_bitmap_in_pager++;
            2 == keystatus.key && 0 < psy_pager.current_bitmap_in_pager && psy_pager.current_bitmap_in_pager--;
            3 == keystatus.key ?
                (current_block = psy_pager.original_block, psy_clear_screen_db(), setTimeout(current_block + ".run()", 10)) : (psy_clear_stimulus_counters_db(), psy_add_centered_bitmap_db(psy_pager.bitmaps[psy_pager.current_bitmap_in_pager], PSY_CENTRAL, PSY_CENTRAL, 0), psy_draw_all_db(), psy_readkey.expectedkey = 32, psy_readkey.keys = [32, 40, 38, 81], psy_expect_keyboard(), psy_readkey.start(current_block, 99999999))
        }
    };

    function psy_store_mouse() {
        psy_mouse_store = psy_mouse_cursor
    }

    function psy_restore_mouse() {
        psy_mouse_visibility(psy_mouse_store)
    }

    var psy_mouse_pager = {
        original_block: "", current_bitmap_in_pager: 0, read_all: !1, bitmaps: [], n: 0, start: function (a) {
            psy_mouse_pager.original_block = current_block;
            psy_mouse_pager.n = a.length;
            psy_mouse_pager.bitmaps = a;
            current_block = "psy_mouse_pager";
            psy_mouse_pager.current_bitmap_in_pager = 0;
            psy_mouse_pager.read_all = !1;
            keystatus.key = -1;
            psy_mouse_pager.run();
            psy_store_mouse();
            psy_mouse_visibility(1)
        }, run: function () {
            3 == keystatus.bitmap && psy_mouse_pager.current_bitmap_in_pager < psy_mouse_pager.n - 1 && (psy_mouse_pager.current_bitmap_in_pager++,
            psy_mouse_pager.current_bitmap_in_pager == psy_mouse_pager.n - 1 && (psy_mouse_pager.read_all = !0));
            2 == keystatus.bitmap && 0 < psy_mouse_pager.current_bitmap_in_pager && psy_mouse_pager.current_bitmap_in_pager--;
            4 == keystatus.bitmap ? (current_block = psy_mouse_pager.original_block, psy_clear_screen_db(), psy_restore_mouse(), setTimeout(current_block + ".run()", 10)) : (psy_clear_stimulus_counters_db(), psy_add_centered_bitmap_db(psy_mouse_pager.bitmaps[psy_mouse_pager.current_bitmap_in_pager], PSY_CENTRAL, PSY_CENTRAL, 0), psy_add_centered_bitmap_db(pager_options.back,
                pager_options.backX, pager_options.backY, 0), psy_add_centered_bitmap_db(pager_options.next, pager_options.nextX, pager_options.nextY, 0), 1 == psy_mouse_pager.read_all && psy_add_centered_bitmap_db(pager_options.quit, pager_options.quitX, pager_options.quitY, 0), psy_draw_all_db(), psy_expect_mouse(), psy_mouse_click_bitmap_rectangle_range("l", 2, 9999999, 2, 4), psy_readkey.start(current_block, 99999999))
        }
    };

    function psy_add_text_rgb_db(a, b, c, d, e, f, g, k, l, m) {
        psy_stimuli1[psy_stimuli1_end] = new psy_stimulus1;
        psy_stimuli1[psy_stimuli1_end].rect = new Rectangle;
        psy_stimuli1[psy_stimuli1_end].x = b;
        psy_stimuli1[psy_stimuli1_end].y = c;
        psy_stimuli1[psy_stimuli1_end].type = 2;
        psy_stimuli1[psy_stimuli1_end].on = 1;
        ctx.font = psy_fonts[a - 1];
        tmpsize = ctx.measureText(l);
        var n = psy_fonts_size[a - 1];
        var q = tmpsize.width;
        tmpgraphicsCanvas = document.createElement("canvas");
        tmpgraphicsCanvas.width = q;
        tmpgraphicsCanvas.height = Math.round(2 *
            n);
        tmpgraphics = tmpgraphicsCanvas.getContext("2d");
        tmpgraphics.fillStyle = "rgba(0,0,0,0)";
        tmpgraphics.fillRect(0, 0, q, n);
        tmpgraphics.fillStyle = hexrgb(f, g, k);
        tmpgraphics.font = psy_fonts[a - 1];
        tmpgraphics.fillText(l, 0, n + n / 2);
        psy_stimuli1[psy_stimuli1_end].text = tmpgraphicsCanvas;
        a = b;
        f = c;
        0 == m && (b == PSY_CENTRAL && d == PSY_CENTRAL && (a = psy_screen_center_x - q / 2), b != PSY_CENTRAL && d == PSY_CENTRAL && (a = b + psy_screen_x_offset - q / 2), c == PSY_CENTRAL && e == PSY_CENTRAL && (f = psy_screen_center_y - n), c != PSY_CENTRAL && e == PSY_CENTRAL && (f =
            c + psy_screen_y_offset - n));
        1 == m && (b == PSY_CENTRAL && d == PSY_CENTRAL && (a = psy_screen_center_x), b != PSY_CENTRAL && d == PSY_CENTRAL && (a = b + psy_screen_x_offset), c == PSY_CENTRAL && e == PSY_CENTRAL && (f = psy_screen_center_y - n), c != PSY_CENTRAL && e == PSY_CENTRAL && (f = c + psy_screen_y_offset - n));
        2 == m && (b == PSY_CENTRAL && d == PSY_CENTRAL && (a = psy_screen_center_x - q), b != PSY_CENTRAL && d == PSY_CENTRAL && (a = b + psy_screen_x_offset - q), c == PSY_CENTRAL && e == PSY_CENTRAL && (f = psy_screen_center_y - n), c != PSY_CENTRAL && e == PSY_CENTRAL && (f = c + psy_screen_y_offset -
            n));
        0 > a && (a = 0);
        0 > f && (f = 0);
        a > psy_screen_width && (a = psy_screen_width - q);
        f > psy_screen_height && (f = psy_screen_height - n);
        psy_stimuli1[psy_stimuli1_end].rect.x = a;
        psy_stimuli1[psy_stimuli1_end].rect.y = f;
        psy_stimuli1[psy_stimuli1_end].rect.width = q;
        psy_stimuli1[psy_stimuli1_end].rect.height = 2 * n;
        psy_stimuli1_n++;
        psy_stimuli1_end++;
        return psy_stimuli1_end
    }

    function psy_clear_screen_db() {
        psy_clear_stimulus_counters_db();
        psy_draw_all_db()
    }

    function psy_clear_stimuli1(a) {
        a = 0 > a ? psy_stimuli1_end + a : a - 1;
        0 <= a && a < psy_stimuli1_end && 0 != psy_stimuli1[a].on && (psy_stimuli1[a].on = 0, 5 == psy_stimuli1[a].type && psy_videos[psy_stimuli1[a].bitmap - 1].clear(), psy_stimuli1_n--)
    }

    function psy_unhide_stimuli1(a) {
        a = 0 > a ? psy_stimuli1_end + a : a - 1;
        1 != psy_stimuli1[a].on && (psy_stimuli1[a].on = 1, psy_stimuli1_n++)
    }

    function psy_clear_range_db(a, b) {
        var c = a, d = b;
        a > b && (d = a, c = b);
        for (a = c; a <= d; a++) psy_clear_stimuli1(a)
    }

    function psy_clear_array_db(a) {
        for (var b = 0; b < a.length; b++) psy_clear_stimuli1(a[b])
    }

    function psy_unhide_range_db(a, b) {
        var c = a, d = b;
        a > b && (d = a, c = b);
        for (a = c; a <= d; a++) psy_unhide_stimuli1(a)
    }

    function psy_clear_stimulus_counters_db() {
        for (var a = 0; a < psy_stimuli1_n;) psy_stimuli1[a].on = 0, a++;
        psy_stimuli1_n = psy_stimuli1_end = 0
    }

    function psy_random(a, b) {
        return Math.floor(Math.random() * (b - a + 1) + a)
    }

    function psy_random_weighted(a, b) {
        var c = 0, d = 0, e;
        for (e = 0; e < b; e++) if (0 < a[e]) {
            var f = psy_random(1E4 * a[e], 1E4);
            f > d && (d = f, c = e)
        }
        return c
    }

    function psy_random_by(a, b, c) {
        return Math.floor(Math.random() * (b + c - a) / c) * c + a
    }

    function psy_random_from_array(a) {
        return a[Math.round(Math.random() * (a.length - 1))]
    }

    function psy_draw_all_db() {
        var a = 0, b, c = 0;
        ctx.fillStyle = hexrgb(psy_bgcol_r, psy_bgcol_g, psy_bgcol_b);
        for (ctx.fillRect(0, 0, psy_screen_width, psy_screen_height); c < psy_stimuli1_n;) {
            if (1 == psy_stimuli1[a].on) switch (c++, psy_stimuli1[a].type) {
                case 0:
                    ctx.fillStyle = hexrgb(psy_stimuli1[a].r, psy_stimuli1[a].g, psy_stimuli1[a].b);
                    ctx.fillRect(psy_stimuli1[a].rect.x, psy_stimuli1[a].rect.y, psy_stimuli1[a].rect.width, psy_stimuli1[a].rect.height);
                    break;
                case 1:
                    0 == psy_stimuli1[a].R ? ctx.drawImage(psy_bitmaps[psy_stimuli1[a].bitmap -
                    1], psy_stimuli1[a].rect.x, psy_stimuli1[a].rect.y) : (ctx.save(), ctx.translate(psy_screen_width / 2, psy_screen_height / 2), ctx.rotate(psy_stimuli1[a].R * Math.PI / 1800), ctx.drawImage(psy_bitmaps[psy_stimuli1[a].bitmap - 1], psy_stimuli1[a].rect.x - psy_screen_width / 2, psy_stimuli1[a].rect.y - psy_screen_height / 2), ctx.restore());
                    break;
                case 2:
                    ctx.drawImage(psy_stimuli1[a].text, psy_stimuli1[a].rect.x, psy_stimuli1[a].rect.y);
                    break;
                case 3:
                    ctx.fillStyle = hexrgb(psy_stimuli1[a].r, psy_stimuli1[a].g, psy_stimuli1[a].b);
                    ctx.beginPath();
                    ctx.arc(psy_stimuli1[a].rect.x + psy_stimuli1[a].rect.width / 2, psy_stimuli1[a].rect.y + psy_stimuli1[a].rect.height / 2, psy_stimuli1[a].rect.width / 2, 0, 2 * Math.PI);
                    ctx.closePath();
                    ctx.fill();
                    break;
                case 4:
                    for (b = 0; b < psy_pb.item1; b++) ctx.fillStyle = hexrgb(psy_pb.color1[0], psy_pb.color1[1], psy_pb.color1[2]), ctx.fillRect(psy_stimuli1[a].rect.x + b * psy_pb.itemwidth + b * psy_pb.between, psy_stimuli1[a].rect.y, psy_pb.itemwidth, psy_stimuli1[a].rect.height);
                    for (b = psy_pb.item1; b < psy_pb.item2; b++) ctx.fillStyle = hexrgb(psy_pb.color2[0],
                        psy_pb.color2[1], psy_pb.color2[2]), ctx.fillRect(psy_stimuli1[a].rect.x + b * psy_pb.itemwidth + b * psy_pb.between, psy_stimuli1[a].rect.y, psy_pb.itemwidth, psy_stimuli1[a].rect.height);
                    break;
                case 6:
                    ctx.strokeStyle = hexrgb(psy_stimuli1[a].r, psy_stimuli1[a].g, psy_stimuli1[a].b), ctx.lineWidth = psy_stimuli1[a].bitmap, ctx.beginPath(), ctx.moveTo(psy_stimuli1[a].rect.x, psy_stimuli1[a].rect.y), ctx.lineTo(psy_stimuli1[a].rect.width, psy_stimuli1[a].rect.height), ctx.stroke()
            }
            a++
        }
    }

    function psy_add_line(a, b, c, d, e, f, g, k) {
        psy_stimuli1[psy_stimuli1_end] = new psy_stimulus1;
        psy_stimuli1[psy_stimuli1_end].rect = new Rectangle;
        psy_stimuli1[psy_stimuli1_end].x = a;
        psy_stimuli1[psy_stimuli1_end].y = b;
        psy_stimuli1[psy_stimuli1_end].type = 6;
        psy_stimuli1[psy_stimuli1_end].on = 1;
        a += psy_screen_x_offset;
        b += psy_screen_y_offset;
        c += psy_screen_x_offset;
        d += psy_screen_y_offset;
        psy_stimuli1[psy_stimuli1_end].rect.x = a;
        psy_stimuli1[psy_stimuli1_end].rect.y = b;
        psy_stimuli1[psy_stimuli1_end].rect.width = c;
        psy_stimuli1[psy_stimuli1_end].rect.height =
            d;
        psy_stimuli1[psy_stimuli1_end].r = f;
        psy_stimuli1[psy_stimuli1_end].g = g;
        psy_stimuli1[psy_stimuli1_end].b = k;
        psy_stimuli1[psy_stimuli1_end].bitmap = e;
        psy_stimuli1_n++;
        psy_stimuli1_end++;
        return psy_stimuli1_end
    }

    function psy_add_centered_rectangle_rgb_db(a, b, c, d, e, f, g) {
        psy_stimuli1[psy_stimuli1_end] = new psy_stimulus1;
        psy_stimuli1[psy_stimuli1_end].rect = new Rectangle;
        psy_stimuli1[psy_stimuli1_end].x = a;
        psy_stimuli1[psy_stimuli1_end].y = b;
        psy_stimuli1[psy_stimuli1_end].type = 0;
        psy_stimuli1[psy_stimuli1_end].on = 1;
        a = a == PSY_CENTRAL ? psy_screen_center_x - c / 2 : a + psy_screen_x_offset - c / 2;
        b = b == PSY_CENTRAL ? psy_screen_center_y - d / 2 : b + psy_screen_y_offset - d / 2;
        psy_stimuli1[psy_stimuli1_end].rect.x = a;
        psy_stimuli1[psy_stimuli1_end].rect.y =
            b;
        psy_stimuli1[psy_stimuli1_end].rect.width = c;
        psy_stimuli1[psy_stimuli1_end].rect.height = d;
        psy_stimuli1[psy_stimuli1_end].r = e;
        psy_stimuli1[psy_stimuli1_end].g = f;
        psy_stimuli1[psy_stimuli1_end].b = g;
        psy_stimuli1_n++;
        psy_stimuli1_end++;
        return psy_stimuli1_end
    }

    function psy_add_centered_circle_rgb_db(a, b, c, d, e, f) {
        psy_stimuli1[psy_stimuli1_end] = new psy_stimulus1;
        psy_stimuli1[psy_stimuli1_end].rect = new Rectangle;
        psy_stimuli1[psy_stimuli1_end].x = a;
        psy_stimuli1[psy_stimuli1_end].y = b;
        psy_stimuli1[psy_stimuli1_end].type = 3;
        psy_stimuli1[psy_stimuli1_end].on = 1;
        a = a == PSY_CENTRAL ? psy_screen_center_x - c : a + psy_screen_x_offset - c;
        b = b == PSY_CENTRAL ? psy_screen_center_y - c : b + psy_screen_y_offset - c;
        psy_stimuli1[psy_stimuli1_end].rect.x = a;
        psy_stimuli1[psy_stimuli1_end].rect.y = b;
        psy_stimuli1[psy_stimuli1_end].rect.width = 2 * c;
        psy_stimuli1[psy_stimuli1_end].rect.height = 2 * c;
        psy_stimuli1[psy_stimuli1_end].r = d;
        psy_stimuli1[psy_stimuli1_end].g = e;
        psy_stimuli1[psy_stimuli1_end].b = f;
        psy_stimuli1_n++;
        psy_stimuli1_end++;
        return psy_stimuli1_end
    }

    function psy_add_centered_bitmap_db(a, b, c, d) {
        psy_stimuli1[psy_stimuli1_end] = new psy_stimulus1;
        psy_stimuli1[psy_stimuli1_end].rect = new Rectangle;
        psy_stimuli1[psy_stimuli1_end].x = b;
        psy_stimuli1[psy_stimuli1_end].y = c;
        psy_stimuli1[psy_stimuli1_end].R = d;
        psy_stimuli1[psy_stimuli1_end].type = 1;
        psy_stimuli1[psy_stimuli1_end].on = 1;
        psy_stimuli1[psy_stimuli1_end].bitmap = a;
        b = b == PSY_CENTRAL ? psy_screen_center_x - psy_bitmaps[a - 1].width / 2 : b + psy_screen_x_offset - psy_bitmaps[a - 1].width / 2;
        c = c == PSY_CENTRAL ? psy_screen_center_y -
            psy_bitmaps[a - 1].height / 2 : c + psy_screen_y_offset - psy_bitmaps[a - 1].height / 2;
        psy_stimuli1[psy_stimuli1_end].rect.x = b;
        psy_stimuli1[psy_stimuli1_end].rect.y = c;
        psy_stimuli1[psy_stimuli1_end].rect.width = psy_bitmaps[a - 1].width;
        psy_stimuli1[psy_stimuli1_end].rect.height = psy_bitmaps[a - 1].height;
        psy_stimuli1_n++;
        psy_stimuli1_end++;
        return psy_stimuli1_end
    }

    function psy_add_pb(a, b, c, d, e, f, g, k, l, m, n, q, t, u) {
        psy_stimuli1[psy_stimuli1_end] = new psy_stimulus1;
        psy_stimuli1[psy_stimuli1_end].rect = new Rectangle;
        0 == e && (e = psy_screen_width, f = 5, d = psy_screen_height / 2 * -1 + 3);
        psy_pb.item1 = a;
        psy_pb.item2 = b;
        psy_pb.color1 = [l, m, n];
        psy_pb.color2 = [q, t, u];
        psy_pb.between = k;
        psy_pb.layout = g;
        psy_pb.itemwidth = Math.ceil(e / b) - k;
        psy_pb.layout = g;
        psy_stimuli1[psy_stimuli1_end].x = c;
        psy_stimuli1[psy_stimuli1_end].y = d;
        psy_stimuli1[psy_stimuli1_end].w = e;
        psy_stimuli1[psy_stimuli1_end].h =
            f;
        psy_stimuli1[psy_stimuli1_end].type = 4;
        psy_stimuli1[psy_stimuli1_end].on = 1;
        psy_stimuli1[psy_stimuli1_end].rect.x = c + psy_screen_x_offset - e / 2;
        psy_stimuli1[psy_stimuli1_end].rect.y = d + psy_screen_y_offset - f / 2;
        psy_stimuli1[psy_stimuli1_end].rect.width = e;
        psy_stimuli1[psy_stimuli1_end].rect.height = f;
        psy_stimuli1_n++;
        psy_stimuli1_end++;
        return psy_stimuli1_end
    }

    function psy_set_coordinate_system(a) {
        "c" == a && (psy_screen_x_offset = psy_screen_center_x, psy_screen_y_offset = psy_screen_center_y)
    }

    function Rectangle() {
        this.h = this.w = this.y = this.x = 0
    }

    function psy_stimulus1() {
        this.rect = this.R = this.h = this.w = this.y = this.x = this.bitmap = this.a = this.b = this.g = this.r = this.type = this.on = 0
    }

    var psy_stimuli1 = [], psy_stimuli1_n = 0, psy_stimuli1_end = 0;

    function psy_mouse_visibility(a) {
        1 == a ? (psy_canvas.style.cursor = "default", psy_mouse_cursor = 1) : (psy_canvas.style.cursor = "none", psy_mouse_cursor = 0)
    }

    var trial_counter, i, trials_left_to_do = 0, tasklist_end_request = 0, experiment_end_request = 0,
        Timer_tasklist_begin, Timer_tasklist_now, maxtasklisttime = 0, TRIAL_SELECTION_RANDOM = 0,
        TRIAL_SELECTION_RANDOM_NEVER_REPEAT = 1, TRIAL_SELECTION_FIXED_SEQUENCE = 2,
        TRIAL_SELECTION_REPEAT_ON_ERROR = 3, TRIAL_SELECTION_ONCE = 4, TRIAL_SELECTION_EQUAL = 5, error_status;
    trial_counter_per_task = [];
    task_probability = [];
    var blockname = "", blockrepeat = 1, current_trial = [], current_task = "", current_block = "";

    function psy_time_since_start() {
        return (new Date).getTime() - psy_exp_start_time
    }

    function psy_diff_timers(a, b) {
        return b - a
    }

    function psy_delay(a) {
        setTimeout(current_task + ".run();", a)
    }

    function psy_delay_block(a) {
        setTimeout(current_block + ".run();", a)
    }

    var psy_chosen_n = 0, psy_chosen_objects = [], choose = {
        first: 0,
        last: 0,
        counter1: 0,
        counter2: 0,
        mouse_select_bitmap: 0,
        mouse_select_bg_bitmap: 0,
        keep: !1,
        minselect: 0,
        maxselect: 9999,
        current_exit_bitmap_num: 0,
        n_selected: 0,
        exit: -1,
        exit_bitmap_1: -1,
        exit_bitmap_2: -1,
        selectedstimuli: [],
        expect_key: 0,
        timer: 0,
        getmouseclick: function (a) {
            1 == choose.expect_key && (canvas_x_offset = psy_canvas.getBoundingClientRect().left, canvas_y_offset = psy_canvas.getBoundingClientRect().top, canvas_w = psy_canvas.getBoundingClientRect().width, canvas_h =
                psy_canvas.getBoundingClientRect().height, tmpmouseX = Math.round((a.clientX - canvas_x_offset) * psy_screen_width / canvas_w) - psy_screen_x_offset, tmpmouseY = Math.round((a.clientY - canvas_y_offset) * psy_screen_height / canvas_h) - psy_screen_y_offset, tmpnum = psy_bitmap_under_mouse(0, choose.current_exit_bitmap_num, choose.current_exit_bitmap_num, tmpmouseX, tmpmouseY), tmpnum == choose.current_exit_bitmap_num && choose.n_selected >= choose.minselect && choose.n_selected <= choose.maxselect ? choose.stop() : (tmpnum = psy_bitmap_under_mouse(0,
                choose.first, choose.last, tmpmouseX, tmpmouseY), tmpx = psy_stimuli1[tmpnum - 1].x, tmpy = psy_stimuli1[tmpnum - 1].y, null == choose.selectedstimuli[tmpnum] ? choose.n_selected < choose.maxselect && (choose.selectedstimuli[tmpnum] = psy_add_centered_bitmap_db(choose.mouse_select_bitmap, tmpx, tmpy), choose.n_selected++) : (psy_clear_stimuli1(choose.selectedstimuli[tmpnum]), choose.selectedstimuli[tmpnum] = null, choose.n_selected--), choose.n_selected >= choose.minselect && choose.n_selected <= choose.maxselect ? choose.current_exit_bitmap_num ==
                choose.exit_bitmap_2 && (psy_unhide_stimuli1(choose.exit_bitmap_1), psy_clear_stimuli1(choose.exit_bitmap_2), choose.current_exit_bitmap_num = choose.exit_bitmap_1) : choose.current_exit_bitmap_num == choose.exit_bitmap_1 && (psy_unhide_stimuli1(choose.exit_bitmap_2), psy_clear_stimuli1(choose.exit_bitmap_1), choose.current_exit_bitmap_num = choose.exit_bitmap_2), psy_draw_all_db()))
        },
        timeout: function () {
            psy_chosen_n = 0;
            psy_chosen_objects = Array(100).fill(0);
            for (i = choose.first; i <= choose.last; i++) null != choose.selectedstimuli[i] &&
            (psy_chosen_objects[psy_chosen_n] = i, psy_chosen_n++);
            window.removeEventListener("mousedown", choose.getmouseclick, !1);
            psy_clear_stimuli1(choose.exit_bitmap_1);
            psy_clear_stimuli1(choose.exit_bitmap_2);
            if (!choose.keep) {
                for (i = choose.first; i < choose.last; i++) null != choose.selectedstimuli[i] && psy_clear_stimuli1(choose.selectedstimuli[i]);
                psy_stimuli1_n = choose.counter1;
                psy_stimuli1_end = choose.counter2
            }
            psy_draw_all_db();
            choose.expect_key = 0;
            choose.maxselect = 9999;
            setTimeout(current_task + ".run()", 0)
        },
        stop: function () {
            keystatus.time =
                (new Date).getTime() - choose.starttime;
            clearTimeout(choose.timer);
            choose.timeout()
        }
    };

    function psy_choose(a, b, c, d, e, f, g) {
        keystatus.rt = a;
        keystatus.time = a;
        keystatus.status = 3;
        choose.counter1 = psy_stimuli1_n;
        choose.counter2 = psy_stimuli1_end;
        choose.exit_bitmap_1 = psy_add_centered_bitmap_db(d, f, g);
        choose.exit_bitmap_2 = psy_add_centered_bitmap_db(e, f, g);
        psy_clear_stimuli1(choose.exit_bitmap_1);
        psy_clear_stimuli1(choose.exit_bitmap_2);
        choose.expect_key = 1;
        choose.n_selected = 0;
        choose.first = b;
        choose.last = c;
        choose.selectedstimuli = [];
        choose.n_selected >= choose.minselect && choose.n_selected <= choose.maxselect ?
            (psy_unhide_stimuli1(choose.exit_bitmap_1), choose.current_exit_bitmap_num = choose.exit_bitmap_1) : (psy_unhide_stimuli1(choose.exit_bitmap_2), choose.current_exit_bitmap_num = choose.exit_bitmap_2);
        psy_draw_all_db();
        window.addEventListener("mousedown", choose.getmouseclick, !1);
        choose.timer = setTimeout("choose.timeout()", a);
        choose.starttime = (new Date).getTime()
    }

    function psy_scale_point_x(a, b, c, d, e) {
        xlimrange = e - d;
        rangefactor = c / xlimrange;
        return b + (a - d) * rangefactor
    }

    function psy_scale_point_y(a, b, c, d, e) {
        ylimrange = e - d;
        rangefactor = c / ylimrange;
        return b + c - (a - d) * rangefactor
    }

    function psy_palette(a) {
        switch (a) {
            case 1:
                color = "white";
                break;
            case 2:
                color = "red";
                break;
            case 3:
                color = "green";
                break;
            case 4:
                color = "yellow";
                break;
            case 5:
                color = "blue"
        }
        return color
    }

    function psy_plot_xaxis(a, b, c, d, e) {
        var f;
        for (f = d; f < e; f++) 0 == f % 100 ? (ctx.fillStyle = "white", ctx.font = "12px Arial", ctx.fillText(f, psy_scale_point_x(f, a, c, d, e) - 10, b + 20), ctx.beginPath(), ctx.moveTo(psy_scale_point_x(f, a, c, d, e), b), ctx.lineTo(psy_scale_point_x(f, a, c, d, e), b + 8), ctx.stroke()) : 0 == f % 10 && (ctx.beginPath(), ctx.moveTo(psy_scale_point_x(f, a, c, d, e), b), ctx.lineTo(psy_scale_point_x(f, a, c, d, e), b + 4), ctx.stroke())
    }

    function psy_plot_yaxis(a, b, c, d, e) {
        var f;
        for (f = d; f < e; f++) 0 == f % 50 ? (ctx.fillStyle = "white", ctx.font = "12px Arial", ctx.fillText(f, a - 30, psy_scale_point_y(f, b, c, d, e) + 3), ctx.beginPath(), ctx.moveTo(a - 8, psy_scale_point_y(f, b, c, d, e)), ctx.lineTo(a, psy_scale_point_y(f, b, c, d, e)), ctx.stroke()) : 0 == f % 10 && (ctx.beginPath(), ctx.moveTo(a - 4, psy_scale_point_y(f, b, c, d, e)), ctx.lineTo(a, psy_scale_point_y(f, b, c, d, e)), ctx.stroke())
    }

    function psy_plot_circle(a, b, c, d) {
        ctx.fillStyle = d;
        ctx.beginPath();
        ctx.arc(a, b, c, 0, 2 * Math.PI);
        ctx.closePath();
        ctx.fill()
    }

    function numsort(a, b) {
        return a - b
    }

    function minimum(a) {
        tmp = a.slice();
        return tmp.sort(numsort)[0]
    }

    function maximum(a) {
        tmp = a.slice();
        return tmp.sort(numsort)[tmp.length - 1]
    }

    function psy_xyplot(a, b, c, d, e, f, g, k, l, m) {
        xlim1 = minimum(g) - 10;
        xlim2 = maximum(g) + 10;
        ylim1 = minimum(k) - 10;
        ylim2 = maximum(k) + 10;
        for (i = 0; i < g.length; i++) psy_plot_circle(psy_scale_point_x(g[i], a, c, xlim1, xlim2), psy_scale_point_y(k[i], b, d, ylim1, ylim2), 4, psy_palette(f));
        ctx.beginPath();
        ctx.strokeStyle = psy_palette(f);
        ctx.rect(a, b, c, d);
        ctx.stroke();
        psy_plot_xaxis(a, b + d, c, xlim1, xlim2);
        psy_plot_yaxis(a, b, d, ylim1, ylim2);
        ctx.fillStyle = "white";
        ctx.font = "12px Arial";
        ctx.fillText(l, a + c / 2, b + d + 30);
        ctx.save();
        ctx.translate(a -
            50, b + d / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.textAlign = "center";
        ctx.fillText(m, 0, 0);
        ctx.restore()
    }

    function psy_lineplot(a, b, c, d, e, f, g, k, l) {
        xlim1 = -4;
        xlim2 = f.length + 5;
        ylim1 = minimum(f) - 10;
        ylim2 = maximum(f) + 10;
        for (i = previousy = previousx = 0; i < f.length; i++) tmpx = psy_scale_point_x(i, a, c, xlim1, xlim2), tmpy = psy_scale_point_y(f[i], b, d, ylim1, ylim2), psy_plot_circle(tmpx, tmpy, 4, psy_palette(g[i])), 0 < i && (ctx.strokeStyle = "white", ctx.beginPath(), ctx.moveTo(previousx, previousy), ctx.lineTo(tmpx, tmpy), ctx.stroke()), previousx = tmpx, previousy = tmpy;
        ctx.beginPath();
        ctx.strokeStyle = "white";
        ctx.rect(a, b, c, d);
        ctx.stroke();
        psy_plot_xaxis(a,
            b + d, c, xlim1, xlim2);
        psy_plot_yaxis(a, b, d, ylim1, ylim2);
        ctx.fillStyle = "white";
        ctx.font = "12px Arial";
        ctx.fillText(k, a + c / 2, b + d + 30);
        ctx.save();
        ctx.translate(a - 50, b + d / 2);
        ctx.rotate(-Math.PI / 2);
        ctx.textAlign = "center";
        ctx.fillText(l, 0, 0);
        ctx.restore()
    }

    function psy_fullscreen(a) {
        a.requestFullScreen ? a.requestFullScreen() : a.webkitRequestFullScreen ? a.webkitRequestFullScreen(psy_canvas.ALLOW_KEYBOARD_INPUT) : a.mozRequestFullScreen ? a.mozRequestFullScreen() : a.msRequestFullscreen && a.msRequestFullscreen()
    }

    function psy_screen_scale(a, b) {
        a = void 0 === a ? 0 : a;
        b = void 0 === b ? !1 : b;
        var c = document.getElementById("cbox"), d = document.getElementById("exp");
        if (b || document.fullscreenElement || document.webkitFullscreenElement) {
            b = window.screen.width / psy_screen_width;
            var e = window.screen.height / psy_screen_height;
            c.style.width = parseInt(window.screen.width) + "px";
            c.style.height = parseInt(window.screen.height) + "px";
            c.style.overflow = "hidden"
        } else c.style.width = psy_frame_w + "px", c.style.height = psy_frame_h + "px", c.style.overflow = "hidden",
            c.style.display = "flex", c.style.alignItems = "center", c.style.justifyContent = "center", b = parseInt(c.style.width) / psy_screen_width, e = parseInt(c.style.height) / psy_screen_height;
        1 == a && (d.style.transform = "scale(" + Math.min(b, e).toFixed(2) + "," + Math.min(b, e).toFixed(2) + ")");
        2 == a && (d.style.transform = "scale(" + Math.min(b).toFixed(2) + "," + Math.min(e).toFixed(2) + ")")
    }

    function psy_exit_fullscreen() {
        document.exitFullScreen ? document.exitFullScreen() : document.webkitCancelFullScreen ? document.webkitCancelFullScreen() : document.mozCancelFullScreen ? document.mozCancelFullScreen() : document.msExitFullscreen && document.msExitFullscreen()
    }

    function psy_rotate_existing_stimulus(a, b) {
        tmp = 0 > a ? psy_stimuli1_end + a : a - 1;
        psy_stimuli1[tmp].R = b
    }

    function psy_relocate_existing_stimulus(a, b, c) {
        tmp = 0 > a ? psy_stimuli1_end + a : a - 1;
        psy_stimuli1[tmp].x = b;
        psy_stimuli1[tmp].y = c;
        a = psy_stimuli1[tmp].rect.width;
        var d = psy_stimuli1[tmp].rect.height;
        tmpx = b == PSY_CENTRAL ? psy_screen_center_x - a / 2 : b + psy_screen_x_offset - a / 2;
        tmpy = c == PSY_CENTRAL ? psy_screen_center_y - d / 2 : c + psy_screen_y_offset - d / 2;
        psy_stimuli1[tmp].rect.x = tmpx;
        psy_stimuli1[tmp].rect.y = tmpy
    }

    function psy_move_existing_stimulus(a, b, c) {
        tmp = 0 > a ? psy_stimuli1_end + a : a - 1;
        psy_stimuli1[tmp].x += b;
        psy_stimuli1[tmp].y += c;
        a = psy_stimuli1[tmp].x;
        b = psy_stimuli1[tmp].y;
        c = psy_stimuli1[tmp].rect.width;
        var d = psy_stimuli1[tmp].rect.height;
        tmpx = a == PSY_CENTRAL ? psy_screen_center_x - c / 2 : a + psy_screen_x_offset - c / 2;
        tmpy = b == PSY_CENTRAL ? psy_screen_center_y - d / 2 : b + psy_screen_y_offset - d / 2;
        psy_stimuli1[tmp].rect.x = tmpx;
        psy_stimuli1[tmp].rect.y = tmpy
    }

    var rate = {
        first: 0,
        last: 0,
        rt: 0,
        status: 0,
        selected: -1,
        counter1: 0,
        counter2: 0,
        keep: !1,
        exit: -1,
        left_bitmap: 0,
        right_bitmap: 0,
        item_bitmap: 0,
        between_px: 20,
        expect_key: 0,
        timer: 0,
        getmouseclick: function (a) {
            1 == rate.expect_key && (canvas_x_offset = psy_canvas.getBoundingClientRect().left, canvas_y_offset = psy_canvas.getBoundingClientRect().top, canvas_w = psy_canvas.getBoundingClientRect().width, canvas_h = psy_canvas.getBoundingClientRect().height, tmpmouseX = Math.round((a.clientX - canvas_x_offset) * psy_screen_width / canvas_w) -
                psy_screen_x_offset, tmpmouseY = Math.round((a.clientY - canvas_y_offset) * psy_screen_height / canvas_h) - psy_screen_y_offset, tmpnum = psy_bitmap_under_mouse(0, rate.first, rate.last, tmpmouseX, tmpmouseY), tmpx = psy_stimuli1[tmpnum - 1].x, tmpy = psy_stimuli1[tmpnum - 1].y, tmpnum >= rate.first && tmpnum <= rate.last && (rate.selected = tmpnum - rate.first + 1, rate.expect_key = 0, rate.stop()))
        },
        timeout: function () {
            window.removeEventListener("mousedown", rate.getmouseclick, !1);
            if (!rate.keep) {
                for (i = rate.counter2 + 1; i <= rate.last; i++) psy_clear_stimuli1(i);
                psy_stimuli1_n = rate.counter1;
                psy_stimuli1_end = rate.counter2
            }
            psy_draw_all_db();
            rate.expect_key = 0;
            psy_restore_mouse();
            setTimeout(current_task + ".run()", 0)
        },
        stop: function () {
            rate.rt = (new Date).getTime() - rate.starttime;
            rate.status = 1;
            clearTimeout(rate.timer);
            rate.timeout()
        }
    };

    function psy_rate_go(a, b, c, d) {
        rate.rt = 0;
        rate.selected = -1;
        rate.status = 3;
        psy_store_mouse();
        psy_mouse_visibility(1);
        rate.counter1 = psy_stimuli1_n;
        rate.counter2 = psy_stimuli1_end;
        itemwidth = 0 == rate.item_bitmap ? 20 : psy_bitmaps[rate.item_bitmap - 1].width;
        scaleW = itemwidth * d + rate.between_px * (d - 1);
        0 == rate.left_bitmap ? (psy_add_centered_rectangle_rgb_db(a - (scaleW / 2 + 15 + rate.between_px), b, 30, 30, 255, 255, 255), psy_add_centered_rectangle_rgb_db(a + scaleW / 2 + 15 + rate.between_px, b, 30, 30, 255, 255, 255)) : (psy_add_centered_bitmap_db(rate.left_bitmap,
            a - (scaleW / 2 + psy_bitmaps[rate.left_bitmap - 1].width / 2 + rate.between_px), b, 0), psy_add_centered_bitmap_db(rate.right_bitmap, a + scaleW / 2 + psy_bitmaps[rate.right_bitmap - 1].width / 2 + rate.between_px, b, 0));
        rate.first = psy_stimuli1_end + 1;
        for (i = 0; i < d; i++) 0 == rate.item_bitmap ? psy_add_centered_circle_rgb_db(a - scaleW / 2 + i * (rate.between_px + itemwidth) + itemwidth / 2, b, 10, 255, 255, 0) : psy_add_centered_bitmap_db(rate.item_bitmap, a - scaleW / 2 + i * (rate.between_px + itemwidth) + itemwidth / 2, b, 0);
        rate.last = psy_stimuli1_end;
        psy_draw_all_db();
        rate.expect_key = 1;
        window.addEventListener("mousedown", rate.getmouseclick, !1);
        rate.timer = setTimeout("rate.timeout()", c);
        rate.starttime = (new Date).getTime()
    }

    function start_exp_setup() {
        console.log("w h = " + psy_screen_width + " " + psy_screen_height);
        psy_screen_scale();
        topX = psy_screen_width - psy_screen_width / 2 - 225;
        topY = psy_screen_height - psy_screen_height / 2 - 175;
        botX = psy_screen_width - psy_screen_width / 2 + 225;
        botY = psy_screen_height - psy_screen_height / 2 + 175;
        tmp1 = document.getElementById("exp");
        tmp2 = tmp1.getContext("2d");
        tmp2.fillStyle = "red";
        tmp2.fillRect(topX, topY, 450, 350);
        tmp2.fillStyle = "yellow";
        tmp2.font = "24px Arial";
        tmp2.textAlign = "center";
        psy_startbutton_text ||
        (psy_startbutton_text = "Click to start ...");
        tmp2.fillText(psy_startbutton_text, psy_screen_width / 2, psy_screen_height / 2);
        window.addEventListener("mousedown", tmpmouse, !1);
        ScreenStartTime = (new Date).getTime()
    }

    function psy_array_shuffle(a) {
        a = Array.from(a);
        for (var b, c = a.length - 1; 0 < c; c--) {
            var d = Math.floor(Math.random() * (c + 1));
            b = a[c];
            a[c] = a[d];
            a[d] = b
        }
        return a
    }

    function psy_array_shuffle_no_repeats(a) {
        for (var b, c, d, e, f = [], g = 0, k = 1; 10 > g && 1 == k;) {
            k = 0;
            b = Array.from(a);
            c = b.length;
            for (d = f.length = 0; d < c; d++) {
                e = 0;
                r = Math.floor(Math.random() * (c - d));
                if (0 < d) for (; b[r] == f[d - 1] && 10 > e;) r = Math.floor(Math.random() * (c - d)), e++;
                10 == e && (k = 1);
                f.push(b[r]);
                b.splice(r, 1)
            }
            1 == k && g++
        }
        10 == g && (f = psy_array_shuffle(a));
        return f
    }

    function psy_array_shuffle_no_x_repeats(a, b) {
        for (var c, d, e, f, g, k = [], l = 0, m = 1, n; 10 > l && 1 == m;) {
            m = 0;
            c = Array.from(a);
            d = c.length;
            for (e = k.length = 0; e < d; e++) {
                g = 0;
                r = Math.floor(Math.random() * (d - e));
                if (0 < e) {
                    n = [];
                    for (f = 0; f < b.length; f++) b[f] <= e && n.push(k[e - b[f]]);
                    for (; n.includes(c[r]) && 10 > g;) r = Math.floor(Math.random() * (d - e)), g++
                }
                10 == g && (m = 1);
                k.push(c[r]);
                c.splice(r, 1)
            }
            1 == m && l++
        }
        10 == l && (k = psy_array_shuffle(a));
        return k
    }

    function psy_array_remove_value(a, b) {
        var c, d = [];
        for (c = 0; c < a.length; c++) a[c] != b && d.push(a[c]);
        return d
    }

    function psy_array_uniq(a) {
        var b = [];
        for (i = 0; i < a.length; i++) b.includes(a[i]) || b.push(a[i]);
        return b
    }

    function psy_array_locate(a, b) {
        for (var c = 0, d = !1; c < a.length && 0 == d;) a[c] == b ? d = !0 : c++;
        return c == a.length ? 0 : c + 1
    }

    function psy_array_fill_random(a, b, c) {
        var d = [], e;
        for (e = 0; e < c; e++) d.push(psy_random(a, b));
        return d
    }

    function psy_array_sample_from(a, b) {
        a = Array.from(a);
        var c = [], d;
        for (d = 0; d < b; d++) c.push(a.splice(Math.floor(Math.random() * a.length), 1)[0]);
        return c
    }

    function psy_arrays_equal(a, b) {
        return JSON.stringify(a) === JSON.stringify(b) ? 1 : 0
    }

    function psy_count_match_array(a, b) {
        var c = Math.min(a.length, b.length), d, e = 0;
        for (d = 0; d < c; d++) a[d] == b[d] && e++;
        return e
    }

    function psy_array_mean(a) {
        for (var b = 0, c = 0; c < a.length; c++) b += a[c];
        return b / a.length
    }

    function psy_array_median(a) {
        tmparray = a.sort(function (a, c) {
            return a - c
        });
        a = tmparray.length / 2;
        return a % 1 ? tmparray[a - .5] : (tmparray[a - 1] + tmparray[a]) / 2
    }

    function psy_array_sum(a) {
        for (var b = 0, c = 0; c < a.length; c++) b += a[c];
        return b
    }

    function psy_array_sd(a) {
        for (var b = 0, c = psy_array_mean(a), d = 0; d < a.length; d++) b += Math.pow(a[d] - c, 2);
        return Math.sqrt(b / a.length)
    }

    function psy_array_sd1(a) {
        for (var b = 0, c = psy_array_mean(a), d = 0; d < a.length; d++) b += Math.pow(a[d] - c, 2);
        return Math.sqrt(b / (a.length - 1))
    }

    function psy_start_drag(a, b, c, d, e) {
        psy_drag.starttime = (new Date).getTime();
        psy_drag.fromarray = Array.from(a);
        psy_drag.toarray = Array.from(b);
        psy_drag.snap = c;
        psy_drag.ghost = d;
        psy_drag.maxrt = e;
        psy_drag.changed = 0;
        psy_drag.mousedowneventlistener = !0;
        psy_drag.lasttask = current_task;
        window.addEventListener("mousedown", getmousedowndrag, !1);
        psy_drag.mousedowneventlistener = !0;
        psy_drag.timer = setTimeout(psy_drag.timeout, e)
    }

    function psy_start_dragging(a, b, c, d, e, f) {
        psy_drag.dragging = !0;
        psy_drag.starttime = (new Date).getTime();
        psy_drag.fromarray = [a, f].flat();
        psy_drag.toarray = Array.from(b);
        psy_drag.snap = c;
        psy_drag.ghost = d;
        psy_drag.maxrt = e;
        psy_drag.exit = f;
        psy_drag.changed = 0;
        psy_drag.mousedowneventlistener = !0;
        psy_drag.lasttask = current_task;
        window.addEventListener("mousedown", getmousedowndrag, !1);
        psy_drag.timer = setTimeout(psy_drag.timeout_dragging, e)
    }

    function psy_stimuli_align(a, b, c, d, e, f, g, k) {
        var l = 0, m = 0, n = !1, q = 0, t = 0;
        if (0 == e) {
            switch (c) {
                case 0:
                    l = psy_stimuli1[a - 1].x;
                    break;
                case 1:
                    l = Math.trunc(psy_stimuli1[b - 1].x - psy_stimuli1[b - 1].rect.width / 2 + psy_stimuli1[a - 1].rect.width / 2);
                    break;
                case 2:
                    l = psy_stimuli1[b - 1].x;
                    break;
                case 3:
                    l = Math.trunc(psy_stimuli1[b - 1].x + psy_stimuli1[b - 1].rect.width / 2 - psy_stimuli1[a - 1].rect.width / 2)
            }
            switch (d) {
                case 0:
                    m = psy_stimuli1[a - 1].y;
                    break;
                case 1:
                    m = Math.trunc(psy_stimuli1[b - 1].y - psy_stimuli1[b - 1].rect.height / 2 + psy_stimuli1[a -
                    1].rect.height / 2);
                    break;
                case 2:
                    m = psy_stimuli1[b - 1].y;
                    break;
                case 3:
                    m = Math.trunc(psy_stimuli1[b - 1].y + psy_stimuli1[b - 1].rect.height / 2 - psy_stimuli1[a - 1].rect.height / 2)
            }
        }
        for (; 0 == n;) {
            if (1 == e) {
                switch (c) {
                    case 0:
                        l = psy_stimuli1[a - 1].x;
                        break;
                    case 1:
                        l = Math.trunc(psy_stimuli1[b - 1].x - psy_stimuli1[b - 1].rect.width / 2 + psy_stimuli1[a - 1].rect.width / 2 + q);
                        break;
                    case 2:
                        l = psy_stimuli1[b - 1].x + q;
                        break;
                    case 3:
                        l = Math.trunc(psy_stimuli1[b - 1].x + psy_stimuli1[b - 1].rect.width / 2 - psy_stimuli1[a - 1].rect.width / 2 + q)
                }
                switch (d) {
                    case 0:
                        m =
                            psy_stimuli1[a - 1].y;
                        break;
                    case 1:
                        m = Math.trunc(psy_stimuli1[b - 1].y - psy_stimuli1[b - 1].rect.height / 2 + psy_stimuli1[a - 1].rect.height / 2 + t);
                        break;
                    case 2:
                        m = psy_stimuli1[b - 1].y + t;
                        break;
                    case 3:
                        m = Math.trunc(psy_stimuli1[b - 1].y + psy_stimuli1[b - 1].rect.height / 2 - psy_stimuli1[a - 1].rect.height / 2 + t)
                }
            }
            var u = psy_bitmap_under_mouse_in_range(f, l, m);
            0 == u ? n = !0 : (t += psy_stimuli1[u - 1].rect.height * k, q += psy_stimuli1[u - 1].rect.width * g)
        }
        psy_relocate_existing_stimulus(a, l, m)
    }

    function psy_delete_last_stimulus() {
        1 == psy_stimuli1[psy_stimuli1_end - 1].on && psy_stimuli1_n--;
        psy_stimuli1_end--;
        return psy_stimuli1_end
    }

    function psy_copy_stimulus(a) {
        tmp = 0 > a ? psy_stimuli1_end + a : a - 1;
        psy_stimuli1[psy_stimuli1_end] = Object.assign({}, psy_stimuli1[tmp]);
        1 == psy_stimuli1[psy_stimuli1_end].on && psy_stimuli1_n++;
        psy_stimuli1_end++;
        return psy_stimuli1_end
    }

    function psy_substr(a, b, c) {
        return 0 == a.length ? "" : void 0 == c ? 0 > b ? (b = a.length + b, 0 < b ? a[b] : a[0]) : b <= a.length ? a[b - 1] : a[a.length - 1] : a.substring(0 > b ? a.length + b : b - 1, 0 > c ? a.length + c + 1 : c)
    }

    function psy_fillup(a, b, c) {
        return a.length < b ? a.concat(Array(b - a.length).fill(c)) : a.slice(0, b)
    }

    function formatoutputdata(a) {
        tmp = a.split(/\r?\n/);
        out = "";
        for (i = 0; i < tmp.length - 1; i++) {
            tmp2 = tmp[i].match(/(".*?"|[^" ]+)+(?= *| *$)/g);
            out += "<tr>";
            for (j = 0; j < tmp2.length; j++) out = out + "<td>" + tmp2[j] + "</td>";
            out += "</tr>"
        }
        return out
    }

    function showdata_html() {
        var a = document.createElement("BUTTON"), b = document.createTextNode("Mostra i risultati");
        a.appendChild(b);
        a.setAttribute("onclick", 'showdata.innerHTML = "<table border=1>" + formatoutputdata(outputdata) + "</table>";');
        document.getElementById("showdata").appendChild(a);
        document.getElementById("continuebutton") && (document.getElementById("continuebutton").disabled = !1)
    }

    var instruction1 = 1, instruction2 = 2, correct = 3, mistake = 4, fixpoint = 5, yellowyellow = 6, yellowgreen = 7,
        yellowblue = 8, yellowred = 9, redyellow = 10, redgreen = 11, redblue = 12, redred = 13, greenyellow = 14,
        greengreen = 15, greenblue = 16, greenred = 17, blueyellow = 18, bluegreen = 19, blueblue = 20, bluered = 21,
        arial = 1, StroopCon = 0, StroopInc = 0, StroopEffect = 0, psy_startbutton_text = "Click to start",
        general_trial_counter = 0, selectedoncecount_table_stroop = 0;

    function strooptype(a, b, c, d) {
        this.c1 = a;
        this.c2 = b;
        this.c3 = c;
        this.selected = d
    }

    var t_stroop = [new strooptype("yellow yellow 1", yellowyellow, 4, 0), new strooptype("yellow green  0", yellowgreen, 2, 0), new strooptype("yellow blue   0", yellowblue, 3, 0), new strooptype("yellow red    0", yellowred, 1, 0), new strooptype("red yellow    0", redyellow, 4, 0), new strooptype("red green     0", redgreen, 2, 0), new strooptype("red blue      0", redblue, 3, 0), new strooptype("red red       1", redred, 1, 0), new strooptype("green yellow  0", greenyellow, 4, 0), new strooptype("green green   1", greengreen, 2, 0), new strooptype("green blue    0",
            greenblue, 3, 0), new strooptype("green red     0", greenred, 1, 0), new strooptype("blue yellow   0", blueyellow, 4, 0), new strooptype("blue green    0", bluegreen, 2, 0), new strooptype("blue blue     1", blueblue, 3, 0), new strooptype("blue red      0", bluered, 1, 0)],
        task_stroop = {
            step: 1,
            task_trial_selection: 0,
            current_trial: -1,
            taskname: "task_stroop",
            tasknumber: 1,
            start: function (a) {
                task_stroop.step = 1;
                tablerow = a - 1;
                task_stroop.current_trial = tablerow;
                psy_clear_stimulus_counters_db();
                psy_stop_freqs();
                task_stroop.run()
            },
            run: function () {
                current_task = task_stroop.taskname;
                switch (task_stroop.step) {
                    case 1:
                        task_stroop.step++;
                        general_trial_counter++;
                        error_status = 0;
                        possiblekeys = [82, 86, 66, 71]; // R, G, B, Y => R, V, B, G
                        psy_delay(500);
                        break;
                    case 2:
                        task_stroop.step++;
                        psy_add_centered_bitmap_db(fixpoint, PSY_CENTRAL, PSY_CENTRAL, 0);
                        psy_draw_all_db();
                        psy_delay(200);
                        break;
                    case 3:
                        task_stroop.step++;
                        psy_clear_stimuli1(1);
                        psy_draw_all_db();
                        psy_delay(100);
                        break;
                    case 4:
                        task_stroop.step++;
                        psy_add_centered_bitmap_db(t_stroop[tablerow].c2, PSY_CENTRAL, PSY_CENTRAL,
                            0);
                        psy_draw_all_db();
                        psy_keyboard(possiblekeys, 4, t_stroop[tablerow].c3 - 1, 2E3);
                        break;
                    case 5:
                        task_stroop.step++;
                        psy_clear_stimuli1(2);
                        psy_draw_all_db();
                        1 == keystatus.status && (psy_add_centered_bitmap_db(correct, PSY_CENTRAL, PSY_CENTRAL, 0), psy_draw_all_db());
                        1 != keystatus.status && (psy_add_centered_bitmap_db(mistake, PSY_CENTRAL, PSY_CENTRAL, 0), psy_draw_all_db());
                        psy_delay(500);
                        break;
                    case 6:
                        task_stroop.step++, psy_clear_stimuli1(3), psy_draw_all_db(), addoutput(current_block.substring(6, current_block.length) +
                            " " + t_stroop[tablerow].c1 + " " + (tablerow + 1) + " " + (keystatus.key + 1) + " " + keystatus.status + " " + keystatus.time), setTimeout(current_block + ".run()", 0)
                }
            }
        }, block_messagenumber1 = {
            blockname: "block_messagenumber1", step: 1, trial_counter: 0, start: function () {
                block_messagenumber1.step = 1;
                current_block = "block_messagenumber1";
                psy_clear_stimulus_counters_db();
                block_messagenumber1.run()
            }, run: function () {
                current_block = block_messagenumber1.blockname;
                switch (block_messagenumber1.step) {
                    case 1:
                        block_messagenumber1.step++;
                        psy_wait(instruction1,
                            32);
                        break;
                    case 2:
                        block_messagenumber1.step++;
                        psy_clear_screen_db();
                        block_messagenumber1.run();
                        break;
                    case 3:
                        block_messagenumber1.step++, setTimeout("blocks" + psy_blockorder + ".run()", 0)
                }
            }
        }, block_messagenumber2 = {
            blockname: "block_messagenumber2", step: 1, trial_counter: 0, start: function () {
                block_messagenumber2.step = 1;
                current_block = "block_messagenumber2";
                psy_clear_stimulus_counters_db();
                block_messagenumber2.run()
            }, run: function () {
                current_block = block_messagenumber2.blockname;
                switch (block_messagenumber2.step) {
                    case 1:
                        block_messagenumber2.step++;
                        psy_wait(instruction2, 32);
                        break;
                    case 2:
                        block_messagenumber2.step++;
                        psy_clear_screen_db();
                        block_messagenumber2.run();
                        break;
                    case 3:
                        block_messagenumber2.step++, setTimeout("blocks" + psy_blockorder + ".run()", 0)
                }
            }
        }, block_training = {
            blockname: "block_training",
            step: 1,
            trial_counter: 0,
            trial_counter_per_task: 40,
            max_trials_in_block: 999999,
            criteria_fullfilled: 1,
            choosetask: 0,
            roe: [!1],
            trials: [],
            current_trial: 0,
            start: function () {
                block_training.step = 1;
                current_block = "block_training";
                this.trials = Array(3).fill([].concat($jscomp.arrayFromIterable(Array(16).keys())).map(function (a) {
                    return ++a
                })).flat();
                this.trials = psy_array_shuffle(this.trials);
                this.trials = this.trials.slice(0, 40);
                psy_clear_stimulus_counters_db();
                block_training.run()
            },
            run: function () {
                current_block = block_training.blockname;
                switch (block_training.step) {
                    case 1:
                        block_training.step++;
                        psy_clear_screen_db();
                        block_training.max_trials_in_block = 999999;
                        block_training.criteria_fullfilled = 1;
                        0 < block_training.criteria_fullfilled && block_training.trial_counter <= block_training.max_trials_in_block ? (block_training.trial_counter++, this.current_trial = this.trials.shift(),
                            task_stroop.start(this.current_trial)) : setTimeout("block_training.run()", 0);
                        break;
                    case 2:
                        block_training.step++;
                        block_training.trial_counter_per_task--;
                        0 < error_status && 0 < this.trials.length && this.roe[0] && (this.trials.unshift(this.current_trial), this.trials.pop());
                        if (0 == block_training.trials.length || block_training.trial_counter >= block_training.max_trials_in_block || 1 == tasklist_end_request || 1 == experiment_end_request) tasklist_end_request = block_training.criteria_fullfilled = 0;
                        1 == block_training.criteria_fullfilled &&
                        (block_training.step -= 2);
                        setTimeout("block_training.run()", 0);
                        break;
                    case 3:
                        block_training.step++;
                        psy_clear_screen_db();
                        psy_add_text_rgb_db(1, -100, 0, PSY_CENTRAL, PSY_CENTRAL, 255, 255, 255, "VelocitÃ  in caso di scelta corretta", 0);
                        psy_draw_all_db();
                        datalines = outputdata.split("\n");
                        var a = 0, b = 0, c = 987654321, d = -987654321;
                        for (tmpx = 0; tmpx < datalines.length - 1; tmpx++) datalinenumbers = datalines[tmpx].split(/ +/), 1 == parseInt(datalinenumbers[3]) & 1 == parseInt(datalinenumbers[6]) && (parseInt(datalinenumbers[7]), b += parseInt(datalinenumbers[7]),
                        parseInt(datalinenumbers[7]) < c && (c = parseInt(datalinenumbers[7])), parseInt(datalinenumbers[7]) > d && (d = parseInt(datalinenumbers[7])), a++);
                        StroopCon = 0 < a ? Math.round(b / a) : 0;
                        datalines = outputdata.split("\n");
                        b = a = 0;
                        c = 987654321;
                        d = -987654321;
                        for (tmpx = 0; tmpx < datalines.length - 1; tmpx++) datalinenumbers = datalines[tmpx].split(/ +/), 0 == parseInt(datalinenumbers[3]) & 1 == parseInt(datalinenumbers[6]) && (parseInt(datalinenumbers[7]), b += parseInt(datalinenumbers[7]), parseInt(datalinenumbers[7]) < c && (c = parseInt(datalinenumbers[7])),
                        parseInt(datalinenumbers[7]) > d && (d = parseInt(datalinenumbers[7])), a++);
                        StroopInc = 0 < a ? Math.round(b / a) : 0;
                        StroopEffect = Math.round(StroopInc - StroopCon);
                        tmptext = "Congruente:    " + StroopCon + " ms";
                        psy_add_text_rgb_db(1, -100, 50, PSY_CENTRAL, PSY_CENTRAL, 255, 255, 255, tmptext, 0);
                        psy_draw_all_db();
                        tmptext = "Incongruente:  " + StroopInc + " ms";
                        psy_add_text_rgb_db(1, -100, 100, PSY_CENTRAL, PSY_CENTRAL, 255, 255, 255, tmptext, 0);
                        psy_draw_all_db();
                        tmptext = "Il tuo Effetto Stroop Ã¨: " + StroopEffect + " ms";
                        psy_add_text_rgb_db(1, -100, 150, PSY_CENTRAL, PSY_CENTRAL, 255, 255, 255, tmptext, 0);
                        psy_draw_all_db();
                        psy_add_text_rgb_db(1, -100, 200, PSY_CENTRAL, PSY_CENTRAL, 255, 255, 255, "Premi SPAZIO per terminare", 0);
                        psy_draw_all_db();
                        psy_wait(0, 32);
                        break;
                    case 4:
                        block_training.step++, psy_clear_screen_db(), setTimeout("blocks" + psy_blockorder + ".run()", 0)
                }
            }
        };

    function main() {
        psy_screen_height = 600;
        psy_screen_width = 800;
        psy_screen_center_x = psy_screen_width / 2;
        psy_screen_center_y = psy_screen_height / 2;
        psy_frame_w = 800;
        psy_frame_h = 600;
        psy_screen_scale(0, !1);
        psy_canvas.focus();
        psy_bgcol_b = psy_bgcol_g = psy_bgcol_r = 0;
        psy_set_coordinate_system("c");
        psy_exp_start_time = psy_exp_current_time = (new Date).getTime();
        psy_mouse_visibility(0);
        psy_load_font("Arial", 20);

        psy_load_bitmap("./img/stroop/stroop_instructions-1.png");
        psy_load_bitmap("./img/stroop/stroop_instructions-2.png");
        psy_load_bitmap("./img/stroop/correct.png");
        psy_load_bitmap("./img/stroop/mistake.png");
        psy_load_bitmap("./img/stroop/fixpoint.png");
        psy_load_bitmap("./img/stroop/yellowyellow.png");
        psy_load_bitmap("./img/stroop/yellowgreen.png");
        psy_load_bitmap("./img/stroop/yellowblue.png");
        psy_load_bitmap("./img/stroop/yellowred.png");
        psy_load_bitmap("./img/stroop/redyellow.png");
        psy_load_bitmap("./img/stroop/redgreen.png");
        psy_load_bitmap("./img/stroop/redblue.png");
        psy_load_bitmap("./img/stroop/redred.png");
        psy_load_bitmap("./img/stroop/greenyellow.png");
        psy_load_bitmap("./img/stroop/greengreen.png");
        psy_load_bitmap("./img/stroop/greenblue.png");
        psy_load_bitmap("./img/stroop/greenred.png");
        psy_load_bitmap("./img/stroop/blueyellow.png");
        psy_load_bitmap("./img/stroop/bluegreen.png");
        psy_load_bitmap("./img/stroop/blueblue.png");
        psy_load_bitmap("./img/stroop/bluered.png");

        when_stimuli_loaded_do("blocks" + psy_blockorder + ".run()")
    }

    var blocks1 = {
        blocknumber: 0, nblocks: 3, run: function () {
            blocks1.blocknumber++;
            switch (blocks1.blocknumber) {
                case 1:
                    block_messagenumber1.start();
                    break;
                case 2:
                    block_messagenumber2.start();
                    break;
                case 3:
                    block_training.start();
                    break;
                case 4:
                    document.fullscreen && psy_exit_fullscreen(), showdata_html()
                    savedata_html("savedata_form");
                    document.getElementsByTagName("center")[0].remove();
            }
        }
    };
</script>
<center>
<div id="savedata">
    <form id="savedata_form"></form>
</div>
<div id="showdata"></div>
</center>

</body>
</html>